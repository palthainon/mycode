<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- SEO Meta Tags -->
    <meta name="description" content="Test regular expressions with real-time pattern matching. Debug regex patterns with highlighting and match details. JavaScript regex engine.">
    <meta name="keywords" content="regex tester, regular expression tester, regex debugger, pattern matcher, regex tool, JavaScript regex">
    <meta name="author" content="OldWeb LLC">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://oldweb.tech/system/regex-tester.html">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Regex Tester - OldWeb.tech">
    <meta property="og:description" content="Test regular expressions with real-time pattern matching. Debug regex patterns with highlighting and match details. JavaScript regex engine.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://oldweb.tech/system/regex-tester.html">
    <meta property="og:site_name" content="OldWeb.tech">
    <meta property="og:image" content="https://oldweb.tech/logo/og-image.png">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Regex Tester - OldWeb.tech">
    <meta name="twitter:description" content="Test regular expressions with real-time pattern matching. Debug regex patterns with highlighting and match details. JavaScript regex engine.">
    <meta name="twitter:image" content="https://oldweb.tech/logo/og-image.png">

    <!-- Additional Meta Tags -->
    <meta name="theme-color" content="#1a1a2e">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="../logo/favicon-32x32.png">

    <title>Regex Tester - OldWeb.tech</title>
    <link rel="stylesheet" href="../a11y.css">
    <script src="../a11y-utils.js"></script>
    <script src="../storage-utils.js"></script>
    <script src="../i18n-utils.js"></script>
    <script src="../navigationv2.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 40px 20px;
            color: #fff;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .ascii-logo {
            position: absolute;
            top: 20px;
            right: 40px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.65rem;
            line-height: 1.1;
            color: #4fc3f7;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.3);
            opacity: 0.8;
            white-space: pre;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5rem;
            color: #4fc3f7;
            text-shadow: 0 0 20px rgba(79, 195, 247, 0.3);
        }

        .subtitle {
            text-align: center;
            color: #90caf9;
            font-size: 1rem;
            margin-bottom: 30px;
        }

        .calculator {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #90caf9;
            font-weight: 500;
        }

        .test-input {
            width: 100%;
            min-height: 200px;
            max-height: 400px;
            padding: 12px 16px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            font-size: 0.95rem;
            font-family: 'Consolas', 'Monaco', monospace;
            transition: border-color 0.3s, box-shadow 0.3s;
            line-height: 1.6;
            overflow-y: auto;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            cursor: text;
        }

        .test-input:focus {
            outline: none;
            border-color: #4fc3f7;
            box-shadow: 0 0 15px rgba(79, 195, 247, 0.2);
        }

        .test-input:empty::before {
            content: attr(data-placeholder);
            color: rgba(255, 255, 255, 0.4);
            pointer-events: none;
        }

        .test-input mark {
            background: rgba(102, 187, 106, 0.3);
            color: #fff;
            padding: 2px 0;
            border-left: 3px solid #66bb6a;
            padding-left: 4px;
            border-radius: 2px;
        }

        .test-input mark:hover {
            background: rgba(102, 187, 106, 0.4);
        }

        .char-counter {
            text-align: right;
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            transition: color 0.2s;
        }

        .char-counter.warning {
            color: #ff8a65;
        }

        .match-badge {
            display: inline-block;
            background: #4fc3f7;
            color: #fff;
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 4px;
            font-weight: 600;
            vertical-align: super;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            font-size: 1rem;
            font-family: 'Consolas', 'Monaco', monospace;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #4fc3f7;
            box-shadow: 0 0 15px rgba(79, 195, 247, 0.2);
        }

        input[type="text"]::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        input[type="text"].error {
            border-color: #f44336;
        }

        .flags-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .flag-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .flag-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #4fc3f7;
        }

        .flag-item label {
            color: #90caf9;
            font-size: 0.95rem;
            cursor: pointer;
            user-select: none;
        }

        .presets-section {
            margin-bottom: 20px;
        }

        .presets-label {
            display: block;
            margin-bottom: 12px;
            color: #90caf9;
            font-weight: 500;
        }

        .presets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 10px;
        }

        .preset-btn {
            padding: 8px 12px;
            background: rgba(79, 195, 247, 0.1);
            border: 1px solid rgba(79, 195, 247, 0.3);
            border-radius: 6px;
            color: #4fc3f7;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            white-space: nowrap;
        }

        .preset-btn:hover {
            background: rgba(79, 195, 247, 0.2);
            border-color: rgba(79, 195, 247, 0.5);
            transform: translateY(-1px);
        }

        .match-summary-bar {
            display: none;
            background: rgba(0, 0, 0, 0.3);
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #66bb6a;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }

        .match-summary-bar.show {
            display: flex;
        }

        .match-summary-bar.no-matches {
            border-left-color: #ff8a65;
        }

        .match-info {
            flex: 1;
        }

        .match-count {
            font-size: 1.1rem;
            color: #66bb6a;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .match-count.no-matches {
            color: #ff8a65;
        }

        .match-pattern {
            color: #90caf9;
            font-size: 0.85rem;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
        }

        .export-btn {
            background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%);
            color: #fff;
            border: none;
            padding: 8px 16px;
            font-size: 0.85rem;
            border-radius: 6px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 187, 106, 0.4);
        }

        .btn {
            background: linear-gradient(135deg, #4fc3f7 0%, #2196f3 100%);
            color: #fff;
            border: none;
            padding: 14px 40px;
            font-size: 1.1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
            display: block;
            width: 100%;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(79, 195, 247, 0.4);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%);
        }

        .btn.secondary:hover {
            box-shadow: 0 5px 20px rgba(102, 187, 106, 0.4);
        }

        .btn.tertiary {
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #90caf9;
        }

        .btn.tertiary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: none;
            transform: none;
        }

        .error {
            background: rgba(244, 67, 54, 0.1);
            border-left: 4px solid #f44336;
            color: #ff8a80;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .error.show {
            display: block;
        }

        footer {
            text-align: center;
            color: rgba(255, 255, 255, 0.4);
            font-size: 0.85rem;
            padding-top: 30px;
        }

        .nav-bar {
            position: absolute;
            top: 20px;
            left: 40px;
            display: flex;
            gap: 15px;
            align-items: center;
            z-index: 100;
        }

        .nav-link {
            color: #4fc3f7;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 600;
            transition: color 0.2s, text-shadow 0.2s;
        }

        .nav-link:hover {
            color: #2196f3;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
        }

        .nav-link.current {
            color: #66bb6a;
            border-bottom: 2px solid #66bb6a;
        }

        .nav-separator {
            color: rgba(79, 195, 247, 0.3);
            user-select: none;
        }

        @media (max-width: 768px) {
            .nav-bar {
                position: static;
                justify-content: center;
                flex-wrap: wrap;
                margin-bottom: 20px;
                gap: 10px;
            }

            .ascii-logo {
                position: static;
                text-align: center;
                margin-bottom: 20px;
                font-size: 0.5rem;
            }

            h1 {
                font-size: 2rem;
            }

            .container {
                max-width: 100%;
            }

            .presets-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }

            .match-summary-bar {
                flex-direction: column;
                align-items: flex-start;
            }

            .export-buttons {
                width: 100%;
                flex-direction: column;
            }

            .export-btn {
                width: 100%;
            }
        }
    </style>

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Regex Tester",
      "description": "Test regular expressions with real-time pattern matching. Debug regex patterns with highlighting and match details. JavaScript regex engine.",
      "url": "https://oldweb.tech/regex-tester.html",
      "applicationCategory": "UtilitiesApplication",
      "operatingSystem": "Web Browser",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "creator": {
        "@type": "Organization",
        "name": "OldWeb.tech"
      }
    }
    </script>
</head>
<body>
    <a href="#main-content" class="skip-link" data-i18n="common.skipToContent">Skip to main content</a>
    <div class="ascii-logo" aria-hidden="true">  ___  _    _  __        __   _
 / _ \| | _| | \ \      / /__| |__
| | | | |/ _` | \ \ /\ / / _ \ '_ \
| |_| | | (_| |  \ V  V /  __/ |_) |
 \___/|_|\__,_|   \_/\_/ \___|_.__/
</div>
    <main id="main-content" class="container">
        <h1 data-i18n="tools.regexTester.title">Regex Tester</h1>
        <p class="subtitle" data-i18n="tools.regexTester.subtitle">Test regular expressions with real-time matching</p>

        <div class="calculator">
            <form aria-label="Regular expression tester form">
            <div class="input-group">
                <label for="pattern" data-i18n="tools.regexTester.labels.pattern">Regular Expression Pattern</label>
                <input type="text" id="pattern" placeholder="Enter regex pattern or select from presets..." data-i18n-placeholder="tools.regexTester.placeholders.pattern" aria-required="true" aria-describedby="pattern-help">
                <span id="pattern-help" class="sr-only">Enter a JavaScript regular expression pattern to test</span>
            </div>

            <div class="input-group">
                <label class="presets-label" id="flags-label" data-i18n="tools.regexTester.labels.flags">Regex Flags</label>
                <div class="flags-group" role="group" aria-labelledby="flags-label">
                    <div class="flag-item">
                        <input type="checkbox" id="flagG" checked aria-label="Enable global flag to find all matches instead of just the first">
                        <label for="flagG" data-i18n="tools.regexTester.flags.global">g - Global (find all)</label>
                    </div>
                    <div class="flag-item">
                        <input type="checkbox" id="flagI" aria-label="Enable case insensitive flag to ignore letter case">
                        <label for="flagI" data-i18n="tools.regexTester.flags.caseInsensitive">i - Case insensitive</label>
                    </div>
                    <div class="flag-item">
                        <input type="checkbox" id="flagM" aria-label="Enable multiline flag for anchors to match line breaks">
                        <label for="flagM" data-i18n="tools.regexTester.flags.multiline">m - Multiline</label>
                    </div>
                    <div class="flag-item">
                        <input type="checkbox" id="flagS" aria-label="Enable dotall flag so dot matches newline characters">
                        <label for="flagS" data-i18n="tools.regexTester.flags.dotAll">s - Dotall</label>
                    </div>
                </div>
            </div>

            <div class="presets-section">
                <label class="presets-label" id="presets-label" data-i18n="tools.regexTester.presets.title">Quick Patterns</label>
                <div class="presets-grid" role="group" aria-labelledby="presets-label">
                    <button type="button" class="preset-btn" data-pattern="\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b" data-flags="g" aria-label="Apply pattern to match IPv4 addresses" data-i18n="tools.regexTester.presets.ipv4">IPv4 Address</button>
                    <button type="button" class="preset-btn" data-pattern="\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\/(?:[0-9]|[12][0-9]|3[0-2])\b" data-flags="g" data-i18n="tools.regexTester.presets.ipv4Cidr">IPv4 CIDR</button>
                    <button type="button" class="preset-btn" data-pattern="(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}|(?:[0-9A-Fa-f]{1,4}:){1,7}:|::(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4}|::1" data-flags="g" aria-label="Apply pattern to match IPv6 addresses">IPv6 Address</button>
                    <button type="button" class="preset-btn" data-pattern="([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}" data-flags="g" aria-label="Apply pattern to match MAC addresses with colon separators" data-i18n="tools.regexTester.presets.macColon">MAC (colon)</button>
                    <button type="button" class="preset-btn" data-pattern="([0-9A-Fa-f]{2}-){5}[0-9A-Fa-f]{2}" data-flags="g" data-i18n="tools.regexTester.presets.macDash">MAC (dash)</button>
                    <button type="button" class="preset-btn" data-pattern="([0-9A-Fa-f]{4}\.){2}[0-9A-Fa-f]{4}" data-flags="g" data-i18n="tools.regexTester.presets.macDot">MAC (dot)</button>
                    <button type="button" class="preset-btn" data-pattern="([0-9A-Fa-f]{2}[:-]){5}[0-9A-Fa-f]{2}|([0-9A-Fa-f]{4}\.){2}[0-9A-Fa-f]{4}" data-flags="g" data-i18n="tools.regexTester.presets.macAny">MAC (any)</button>
                    <button type="button" class="preset-btn" data-pattern="\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}\b" data-flags="g" aria-label="Apply pattern to match email addresses">Email Address</button>
                    <button type="button" class="preset-btn" data-pattern="https?://[^\s/$.?#][^\s]*" data-flags="g" aria-label="Apply pattern to match HTTP and HTTPS URLs">URL (http/https)</button>
                    <button type="button" class="preset-btn" data-pattern="[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}" data-flags="gi" aria-label="Apply pattern to match UUID/GUID values">UUID / GUID</button>
                    <button type="button" class="preset-btn" data-pattern="\b(ERROR|WARN(?:ING)?|INFO|DEBUG|CRITICAL|FATAL)\b" data-flags="g" aria-label="Apply pattern to match log severity levels">Log Level</button>
                    <button type="button" class="preset-btn" data-pattern="\b[1-5][0-9]{2}\b" data-flags="g" aria-label="Apply pattern to match HTTP status codes">HTTP Status</button>
                    <button type="button" class="preset-btn" data-pattern="\+?1?[\s.-]?\(?[0-9]{3}\)?[\s.-]?[0-9]{3}[\s.-]?[0-9]{4}" data-flags="g" aria-label="Apply pattern to match US phone numbers">Phone (US)</button>
                    <button type="button" class="preset-btn" data-pattern="\bAS[0-9]{1,10}\b" data-flags="gi" aria-label="Apply pattern to match BGP autonomous system numbers">AS Number</button>
                    <button type="button" class="preset-btn" data-pattern="\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\s+(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b" data-flags="g" data-i18n="tools.regexTester.presets.ipMask">IP + Mask</button>
                    <button type="button" class="preset-btn" data-pattern="\bvlan\s*(\d{1,4})\b" data-flags="gi" data-i18n="tools.regexTester.presets.vlanId">VLAN ID</button>
                    <button type="button" class="preset-btn" data-pattern="\b(?:Ethernet|FastEthernet|GigabitEthernet|eth|ge|fe)\s*[\d/]+" data-flags="gi" data-i18n="tools.regexTester.presets.interface">Interface</button>
                    <button type="button" class="preset-btn" data-pattern="^\s*$" data-flags="gm" data-i18n="tools.regexTester.presets.blankLines">Blank Lines</button>
                    <button type="button" class="preset-btn" data-pattern="^.*$" data-flags="gm" aria-label="Apply pattern to match each line" data-i18n="tools.regexTester.presets.entireLine">Every Line</button>
                </div>
            </div>

            <div class="match-summary-bar" id="matchSummary" role="region" aria-live="polite" aria-label="Pattern match summary">
                <div class="match-info">
                    <div class="match-count" id="matchCount">Found 0 matches</div>
                    <div class="match-pattern" id="matchPattern"></div>
                </div>
                <div class="export-buttons">
                    <button type="button" class="export-btn" onclick="exportCSV()" aria-label="Export matches to CSV file" data-i18n="common.exportCSV">Export CSV</button>
                    <button type="button" class="export-btn" onclick="exportTXT()" aria-label="Export matches to text file" data-i18n="tools.regexTester.buttons.exportTxt">Export TXT</button>
                </div>
            </div>

            <div class="input-group">
                <label for="testString" data-i18n="tools.regexTester.labels.testString">Test String</label>
                <div id="testString" contenteditable="true" class="test-input" data-placeholder="Enter text to test against your regex pattern..." data-i18n-data-placeholder="tools.regexTester.placeholders.testString" aria-label="Test string input" aria-describedby="charCounter" role="textbox" aria-multiline="true"></div>
                <div class="char-counter" id="charCounter" aria-live="polite">0 / 100,000 characters</div>
            </div>

            <div class="error" id="errorMsg" role="alert" aria-live="assertive" aria-atomic="true"></div>

            <button type="button" class="btn" onclick="testPattern()" aria-label="Test regex pattern against entered text" data-i18n="tools.regexTester.buttons.testPattern">Test Pattern</button>
            <button type="button" class="btn secondary" onclick="loadSample()" aria-label="Load sample network configuration data for testing" data-i18n="tools.regexTester.buttons.loadSample">Load Sample Data</button>
            <button type="button" class="btn tertiary" onclick="clearAllSavedData()" aria-label="Clear all saved form data from this page" data-i18n="common.clearSavedData">Clear Saved Data</button>
            </form>
        </div>

        <footer role="contentinfo" data-i18n="common.worksOffline">
            Regex Tester - Works offline, no installation required
        </footer>
    </main>

    <script>
        let matchesData = [];
        let currentPattern = '';
        let currentFlags = '';
        let isHighlighted = false;
        const MAX_CHARS = 100000;

        const testInput = document.getElementById('testString');
        const patternInput = document.getElementById('pattern');
        const charCounter = document.getElementById('charCounter');

        function updateCharCounter() {
            const length = getPlainText().length;
            charCounter.textContent = `${length.toLocaleString()} / ${MAX_CHARS.toLocaleString()} characters`;

            if (length >= MAX_CHARS * 0.9) {
                charCounter.classList.add('warning');
            } else {
                charCounter.classList.remove('warning');
            }
        }

        patternInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                testPattern();
            }
        });

        document.querySelectorAll('.flag-item input').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const testText = getPlainText();
                if (patternInput.value && testText) {
                    testPattern();
                }
            });
        });

        document.querySelectorAll('.preset-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const pattern = this.getAttribute('data-pattern');
                const flags = this.getAttribute('data-flags');

                patternInput.value = pattern;

                document.getElementById('flagG').checked = flags.includes('g');
                document.getElementById('flagI').checked = flags.includes('i');
                document.getElementById('flagM').checked = flags.includes('m');
                document.getElementById('flagS').checked = flags.includes('s');

                if (getPlainText()) {
                    testPattern();
                }
            });
        });

        testInput.addEventListener('input', function() {
            if (isHighlighted) {
                clearHighlights();
            }
            updateCharCounter();
        });

        testInput.addEventListener('paste', function(e) {
            e.preventDefault();
            const text = e.clipboardData.getData('text/plain');
            document.execCommand('insertText', false, text);
        });

        function getPlainText() {
            return testInput.textContent || '';
        }

        function clearHighlights() {
            const text = getPlainText();
            testInput.textContent = text;
            isHighlighted = false;
            document.getElementById('matchSummary').classList.remove('show');
        }

        function testPattern() {
            const errorDiv = document.getElementById('errorMsg');
            const summaryBar = document.getElementById('matchSummary');

            errorDiv.classList.remove('show');
            errorDiv.textContent = '';

            const testString = getPlainText();
            currentPattern = patternInput.value;

            if (!testString) {
                errorDiv.textContent = 'Please enter text to test.';
                errorDiv.classList.add('show');
                summaryBar.classList.remove('show');
                return;
            }

            if (!currentPattern) {
                errorDiv.textContent = 'Please enter a regex pattern.';
                errorDiv.classList.add('show');
                summaryBar.classList.remove('show');
                return;
            }

            currentFlags = '';
            if (document.getElementById('flagG').checked) currentFlags += 'g';
            if (document.getElementById('flagI').checked) currentFlags += 'i';
            if (document.getElementById('flagM').checked) currentFlags += 'm';
            if (document.getElementById('flagS').checked) currentFlags += 's';

            let regex;
            try {
                regex = new RegExp(currentPattern, currentFlags);
            } catch (e) {
                errorDiv.textContent = 'Invalid regex pattern: ' + e.message;
                errorDiv.classList.add('show');
                patternInput.classList.add('error');
                summaryBar.classList.remove('show');
                return;
            }

            patternInput.classList.remove('error');

            matchesData = [];
            let match;

            if (currentFlags.includes('g')) {
                while ((match = regex.exec(testString)) !== null) {
                    matchesData.push({
                        text: match[0],
                        index: match.index,
                        groups: Array.from(match).slice(1),
                        fullMatch: match
                    });

                    if (match[0].length === 0) {
                        regex.lastIndex++;
                    }

                    if (matchesData.length > 1000) {
                        errorDiv.textContent = 'Warning: Only showing first 1000 matches.';
                        errorDiv.classList.add('show');
                        break;
                    }
                }
            } else {
                match = regex.exec(testString);
                if (match) {
                    matchesData.push({
                        text: match[0],
                        index: match.index,
                        groups: Array.from(match).slice(1),
                        fullMatch: match
                    });
                }
            }

            applyHighlights(testString);
            displaySummary();
        }

        function applyHighlights(text) {
            if (matchesData.length === 0) {
                testInput.textContent = text;
                isHighlighted = false;
                return;
            }

            let result = '';
            let lastIndex = 0;

            matchesData.forEach((match, index) => {
                result += escapeHtml(text.substring(lastIndex, match.index));

                if (match.text.length > 0) {
                    result += '<mark>' + escapeHtml(match.text) + '<span class="match-badge">' + (index + 1) + '</span></mark>';
                }

                lastIndex = match.index + match.text.length;
            });

            result += escapeHtml(text.substring(lastIndex));

            testInput.innerHTML = result;
            isHighlighted = true;
        }

        function displaySummary() {
            const summaryBar = document.getElementById('matchSummary');
            const matchCount = document.getElementById('matchCount');
            const matchPattern = document.getElementById('matchPattern');

            const flagsText = currentFlags || 'none';

            if (matchesData.length > 0) {
                matchCount.textContent = `Found ${matchesData.length} match${matchesData.length !== 1 ? 'es' : ''}`;
                matchCount.classList.remove('no-matches');
                summaryBar.classList.remove('no-matches');
            } else {
                matchCount.textContent = 'No matches found';
                matchCount.classList.add('no-matches');
                summaryBar.classList.add('no-matches');
            }

            matchPattern.textContent = `Pattern: /${currentPattern}/${flagsText}`;
            summaryBar.classList.add('show');

            // Announce results
            const matchText = matchesData.length === 1 ? '1 match' : `${matchesData.length} matches`;
            A11yUtils.announce(`Pattern test complete. Found ${matchText}`, 'polite');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function exportCSV() {
            if (matchesData.length === 0) return;

            let csv = '';

            matchesData.forEach((match) => {
                const text = match.text.replace(/"/g, '""');
                csv += `"${text}"\n`;
            });

            downloadFile(csv, 'regex-matches.csv', 'text/csv');
            A11yUtils.announce(`Exported ${matchesData.length} matches to CSV file`, 'polite');
        }

        function exportTXT() {
            if (matchesData.length === 0) return;

            let txt = '';

            matchesData.forEach((match) => {
                txt += match.text + '\n';
            });

            downloadFile(txt, 'regex-matches.txt', 'text/plain');
            A11yUtils.announce(`Exported ${matchesData.length} matches to text file`, 'polite');
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function loadSample() {
            const sample = `interface GigabitEthernet0/1
 description Uplink to Core Switch
 ip address 192.168.1.1 255.255.255.0
 ipv6 address 2001:db8::1/64
 mac-address 00:1A:2B:3C:4D:5E
 vlan 100

interface FastEthernet0/2
 description Access Port
 ip address 10.0.0.254 255.255.255.0
 mac-address aa-bb-cc-dd-ee-ff
 vlan 200

Jan 15 14:23:45 router1 %SYS-5-CONFIG_I: Configured from console by admin
Jan 15 14:24:12 switch1 %LINK-3-UPDOWN: Interface GigabitEthernet0/1, changed state to up
2024-01-15T14:25:00Z ERROR: Connection timeout to 172.16.0.1 after 30s
2024-01-15T14:25:01Z INFO: BGP session with AS65001 established via 203.0.113.1
2024-01-15T14:25:02Z WARN: Interface FastEthernet0/2 utilization at 92%
2024-01-15T14:25:03Z DEBUG: Received OSPF hello from 10.0.0.1 on GigabitEthernet0/1
2024-01-15T14:25:04Z CRITICAL: Core temperature threshold exceeded

User: admin@example.com logged in from 198.51.100.42:8080
Failed login for user@company.org from 203.0.113.7 - HTTP 401 Unauthorized
API call to https://api.example.com/v1/status returned 200 OK
Redirect: https://oldweb.tech/tools

Device UUID: f47ac10b-58cc-4372-a567-0e02b2c3d479
Certificate SN: 3d6f-4a21-b9c0-1234-5678-90ab-cdef-0001
Support hotline: +1 (555) 123-4567 | Backup: 800-555-0100

Routing Table:
10.0.0.0/8 via 192.168.1.254
172.16.0.0/12 via 192.168.1.254
192.168.0.0/16 is directly connected
2001:db8::/32 via fe80::1`;

            testInput.textContent = sample;
            clearHighlights();
            updateCharCounter();
            A11yUtils.announce('Loaded sample data', 'polite');
        }

        // Form field IDs to persist
        const regexFormFields = ['pattern', 'testString', 'flagG', 'flagI', 'flagM', 'flagS'];

        // Clear all saved data and reset form
        function clearAllSavedData() {
            StorageUtils.remove('regex-tester');

            // Reset form fields
            document.getElementById('pattern').value = '';
            document.getElementById('testString').textContent = '';
            document.getElementById('flagG').checked = true;
            document.getElementById('flagI').checked = false;
            document.getElementById('flagM').checked = false;
            document.getElementById('flagS').checked = false;

            // Clear highlights and reset counter
            clearHighlights();
            updateCharCounter();

            // Reset match summary
            document.getElementById('matchCount').textContent = 'Found 0 matches';
            document.getElementById('matchPattern').textContent = '';

            A11yUtils.announce('All saved data has been cleared', 'polite');
        }

        // Load saved data on page load
        document.addEventListener('DOMContentLoaded', function() {
            StorageUtils.loadFormInputs('regex-tester', regexFormFields, function() {
                updateCharCounter();
                // If no saved data, pre-populate with sample data and a default pattern
                const hasPattern = patternInput.value.trim();
                const hasTestString = getPlainText().trim();
                if (!hasPattern && !hasTestString) {
                    loadSample();
                    // Default to IPv4 pattern so users can click Test Pattern immediately
                    patternInput.value = '\\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\b';
                    document.getElementById('flagG').checked = true;
                    document.getElementById('flagI').checked = false;
                    document.getElementById('flagM').checked = false;
                    document.getElementById('flagS').checked = false;
                }
            });

            // Auto-save form inputs on change
            StorageUtils.autoSaveFormInputs('regex-tester', regexFormFields);
        });
    </script>
    <script>
        document.querySelector('.skip-link').addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.getElementById('main-content');
            if (target) {
                target.setAttribute('tabindex', '-1');
                target.focus();
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });
    </script>
</body>
</html>
