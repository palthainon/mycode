<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- SEO Meta Tags -->
    <meta name="description" content="Compare text files and find differences. Side-by-side and unified diff views with line-by-line comparison. Free online text diff tool for developers and sysadmins.">
    <meta name="keywords" content="text diff, file compare, diff tool, text comparison, side by side diff, unified diff, text difference finder">
    <meta name="author" content="OldWeb LLC">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://oldweb.tech/data/text-diff.html">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Text Diff Tool - OldWeb.tech">
    <meta property="og:description" content="Compare text files and find differences. Side-by-side and unified diff views with line-by-line comparison. Free online text diff tool for developers and sysadmins.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://oldweb.tech/data/text-diff.html">
    <meta property="og:site_name" content="OldWeb.tech">
    <meta property="og:image" content="https://oldweb.tech/logo/og-image.svg">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Text Diff Tool - OldWeb.tech">
    <meta name="twitter:description" content="Compare text files and find differences. Side-by-side and unified diff views with line-by-line comparison. Free online text diff tool for developers and sysadmins.">
    <meta name="twitter:image" content="https://oldweb.tech/logo/og-image.svg">

    <!-- Additional Meta Tags -->
    <meta name="theme-color" content="#1a1a2e">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="../logo/favicon-32x32.png">

    <title>Text Diff Tool - OldWeb.tech</title>
    <link rel="stylesheet" href="../a11y.css">
    <script src="../a11y-utils.js"></script>
    <script src="../navigationv2.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 40px 20px;
            color: #fff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-top: 40px;
            margin-bottom: 30px;
            font-size: 2.5rem;
            color: #4fc3f7;
            text-shadow: 0 0 20px rgba(79, 195, 247, 0.3);
        }

        h2 {
            color: #4fc3f7;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        /* ASCII Logo */
        .ascii-logo {
            position: absolute;
            top: 20px;
            right: 40px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.65rem;
            line-height: 1.1;
            color: #4fc3f7;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.3);
            opacity: 0.8;
            white-space: pre;
        }

        /* Main Section */
        .diff-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }

        /* Text Panels Container */
        .text-panels {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
            margin-bottom: 20px;
        }

        .panel-group {
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .panel-header label {
            color: #90caf9;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .panel-status {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
            font-style: italic;
        }

        /* Unified Input/Output Panel */
        .text-panel {
            width: 100%;
            height: 400px;
            padding: 16px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            background: #0f1419;
            color: #fff;
            font-size: 0.9rem;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            line-height: 1.6;
            overflow-y: auto;
            overflow-x: hidden;
            white-space: pre-wrap;
            word-wrap: break-word;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .text-panel:focus {
            outline: none;
            border-color: #4fc3f7;
            box-shadow: 0 0 15px rgba(79, 195, 247, 0.2);
        }

        .text-panel[data-placeholder]:empty::before {
            content: attr(data-placeholder);
            color: rgba(255, 255, 255, 0.4);
            pointer-events: none;
        }

        .text-panel.diff-mode {
            cursor: default;
        }

        /* Diff Line Styling */
        .diff-line {
            display: block;
            padding: 2px 8px;
            margin: 0 -8px;
            border-left: 3px solid transparent;
        }

        .diff-line.added {
            background: rgba(102, 187, 106, 0.2);
            border-left-color: #66bb6a;
            color: #a5d6a7;
        }

        .diff-line.removed {
            background: rgba(244, 67, 54, 0.2);
            border-left-color: #f44336;
            color: #ef9a9a;
        }

        .diff-line.unchanged {
            color: rgba(255, 255, 255, 0.7);
        }

        .diff-line.empty-placeholder {
            color: rgba(255, 255, 255, 0.2);
            font-style: italic;
        }

        .diff-line.collapsed {
            display: none;
        }

        .line-number {
            display: inline-block;
            width: 40px;
            color: rgba(255, 255, 255, 0.3);
            text-align: right;
            margin-right: 12px;
            user-select: none;
        }

        .change-indicator {
            display: inline-block;
            width: 16px;
            font-weight: bold;
            margin-right: 4px;
            user-select: none;
        }

        .diff-line.added .change-indicator {
            color: #66bb6a;
        }

        .diff-line.removed .change-indicator {
            color: #f44336;
        }

        /* Word-level diff highlighting */
        .word-added {
            background: rgba(102, 187, 106, 0.4);
            border-radius: 2px;
            padding: 0 2px;
        }

        .word-removed {
            background: rgba(244, 67, 54, 0.4);
            border-radius: 2px;
            padding: 0 2px;
        }

        .word-changed {
            background: rgba(255, 193, 7, 0.3);
            border-radius: 2px;
            padding: 0 2px;
        }

        /* Current change highlight for navigation */
        .diff-line.current-change {
            box-shadow: inset 0 0 0 2px #ffc107;
        }

        /* Options */
        .options {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .option-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .option-group label {
            color: #90caf9;
            font-weight: 500;
            cursor: pointer;
        }

        .option-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #4fc3f7;
        }

        /* Buttons */
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #4fc3f7 0%, #2196f3 100%);
            color: #fff;
            border: none;
            padding: 14px 40px;
            font-size: 1.1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 195, 247, 0.3);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%);
        }

        .btn.secondary:hover {
            box-shadow: 0 5px 15px rgba(102, 187, 106, 0.3);
        }

        .btn.tertiary {
            background: rgba(79, 195, 247, 0.1);
            border: 2px solid rgba(79, 195, 247, 0.3);
            color: #4fc3f7;
        }

        .btn.tertiary:hover {
            background: rgba(79, 195, 247, 0.2);
            border-color: #4fc3f7;
            box-shadow: 0 5px 15px rgba(79, 195, 247, 0.2);
        }

        /* Stats Section */
        .stats-section {
            display: none;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 20px 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }

        .stats-section.show {
            display: block;
        }

        /* Navigation Bar */
        .nav-bar {
            display: none;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-bar.show {
            display: flex;
        }

        .nav-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-btn {
            background: rgba(79, 195, 247, 0.2);
            border: 1px solid rgba(79, 195, 247, 0.3);
            color: #4fc3f7;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .nav-btn:hover:not(:disabled) {
            background: rgba(79, 195, 247, 0.3);
            border-color: #4fc3f7;
        }

        .nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .change-counter {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            min-width: 80px;
            text-align: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #4fc3f7;
            margin-bottom: 5px;
        }

        .stat-value.added {
            color: #66bb6a;
        }

        .stat-value.removed {
            color: #f44336;
        }

        .stat-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        footer {
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 40px;
            font-size: 0.9rem;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .home-btn {
                top: 10px;
                left: 10px;
                padding: 8px 16px;
                font-size: 0.9rem;
            }

            .container {
                padding: 20px 10px;
            }

            h1 {
                font-size: 2rem;
            }

            .ascii-logo {
                display: none;
            }

            .text-panels {
                grid-template-columns: 1fr;
            }

            .text-panel {
                height: 250px;
            }

            .options {
                flex-direction: column;
                align-items: flex-start;
            }

            .button-group {
                flex-direction: column;
                width: 100%;
            }

            .btn {
                width: 100%;
            }

            .nav-bar {
                flex-direction: column;
                gap: 10px;
            }

            .nav-bar .nav-controls:last-child {
                display: none;
            }

            .change-indicator {
                width: 12px;
                font-size: 0.8rem;
            }

            .line-number {
                width: 30px;
                font-size: 0.8rem;
            }
        }

        /* Scrollbar Styling */
        .text-panel::-webkit-scrollbar {
            width: 10px;
        }

        .text-panel::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        .text-panel::-webkit-scrollbar-thumb {
            background: rgba(79, 195, 247, 0.3);
            border-radius: 4px;
        }

        .text-panel::-webkit-scrollbar-thumb:hover {
            background: rgba(79, 195, 247, 0.5);
        }
    </style>

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Text Diff Tool",
      "description": "Compare text files and find differences. Side-by-side and unified diff views with line-by-line comparison. Free online text diff tool for developers and sysadmins.",
      "url": "https://oldweb.tech/data/text-diff.html",
      "applicationCategory": "UtilitiesApplication",
      "operatingSystem": "Web Browser",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "creator": {
        "@type": "Organization",
        "name": "OldWeb.tech"
      }
    }
    </script>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <div class="ascii-logo" aria-hidden="true">  ___  _     _  __        __   _
 / _ \| | __| | \ \      / /__| |__
| | | | |/ _` |  \ \ /\ / / _ \ '_ \
| |_| | | (_| |   \ V  V /  __/ |_) |
 \___/|_|\__,_|    \_/\_/ \___|_.__/
</div>

    <main id="main-content" class="container">
        <h1>Text Diff Tool</h1>

        <!-- Stats Section -->
        <div class="stats-section" id="statsSection" role="region" aria-label="Comparison statistics" aria-live="polite">
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value added" id="linesAdded">0</div>
                    <div class="stat-label">Added</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value removed" id="linesRemoved">0</div>
                    <div class="stat-label">Removed</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="linesUnchanged">0</div>
                    <div class="stat-label">Unchanged</div>
                </div>
            </div>
        </div>

        <!-- Main Diff Section -->
        <div class="diff-section">
            <form id="diff-form" aria-label="Text Comparison Form">
                <div class="text-panels">
                    <div class="panel-group">
                        <div class="panel-header">
                            <label for="leftPanel">Original Text</label>
                            <span class="panel-status" id="leftStatus" role="status" aria-live="polite"></span>
                        </div>
                        <div class="text-panel"
                             id="leftPanel"
                             contenteditable="true"
                             data-placeholder="Paste or type your original text here..."
                             role="textbox"
                             aria-label="Original text input"
                             aria-multiline="true"
                             aria-describedby="leftPanel-help">EQUAL RIGHTS AMENDMENT (1972)

Section 1. Equality of rights under the law shall not be denied or abridged by the United States or by any state on account of sex.

Section 2. The Congress shall have the power to enforce, by appropriate legislation, the provisions of this article.

Section 3. This amendment shall take effect two years after the date of ratification.

Passed by Congress March 22, 1972. Ratification deadline: March 22, 1979 (extended to June 30, 1982).</div>
                        <span id="leftPanel-help" class="sr-only">Enter or paste the original text you want to compare. After clicking Compare, differences will be highlighted in this panel.</span>
                    </div>
                    <div class="panel-group">
                        <div class="panel-header">
                            <label for="rightPanel">Modified Text</label>
                            <span class="panel-status" id="rightStatus" role="status" aria-live="polite"></span>
                        </div>
                        <div class="text-panel"
                             id="rightPanel"
                             contenteditable="true"
                             data-placeholder="Paste or type your modified text here..."
                             role="textbox"
                             aria-label="Modified text input"
                             aria-multiline="true"
                             aria-describedby="rightPanel-help">EQUAL RIGHTS AMENDMENT (1972)

Section 1. Equality of rights under the law shall not be denied or abridged by the United States or by any state on account of sex.

Section 2. Congress shall have the power to enforce, by appropriate legislation, the provisions of this article.

Section 3. This amendment shall take effect two years after the date of ratification.

Passed by Congress March 22, 1972. Ratification deadline extended to June 30, 1982.</div>
                        <span id="rightPanel-help" class="sr-only">Enter or paste the modified text you want to compare against the original. After clicking Compare, differences will be highlighted in this panel.</span>
                    </div>
                </div>

                <!-- Navigation Bar (shown in diff mode) -->
                <div class="nav-bar" id="navBar" role="navigation" aria-label="Change navigation">
                    <div class="nav-controls">
                        <button type="button" class="nav-btn" id="prevChange" onclick="navigateChange(-1)" aria-label="Previous change">
                            ← Prev
                        </button>
                        <span class="change-counter" id="changeCounter" aria-live="polite">0 / 0</span>
                        <button type="button" class="nav-btn" id="nextChange" onclick="navigateChange(1)" aria-label="Next change">
                            Next →
                        </button>
                    </div>
                    <div class="nav-controls">
                        <span style="color: rgba(255,255,255,0.5); font-size: 0.8rem;">Use ↑↓ keys to navigate changes</span>
                    </div>
                </div>

                <div class="options" role="group" aria-label="Comparison options">
                    <div class="option-group">
                        <input type="checkbox" id="syncScroll" name="syncScroll" checked aria-describedby="syncScroll-help">
                        <label for="syncScroll">Sync Scroll</label>
                        <span id="syncScroll-help" class="sr-only">When enabled, both panels scroll together</span>
                    </div>
                    <div class="option-group">
                        <input type="checkbox" id="ignoreWhitespace" name="ignoreWhitespace" aria-describedby="ignoreWhitespace-help">
                        <label for="ignoreWhitespace">Ignore Whitespace</label>
                        <span id="ignoreWhitespace-help" class="sr-only">When enabled, whitespace differences are ignored during comparison</span>
                    </div>
                    <div class="option-group">
                        <input type="checkbox" id="ignoreCase" name="ignoreCase" aria-describedby="ignoreCase-help">
                        <label for="ignoreCase">Ignore Case</label>
                        <span id="ignoreCase-help" class="sr-only">When enabled, uppercase and lowercase differences are ignored</span>
                    </div>
                    <div class="option-group">
                        <input type="checkbox" id="trimLines" name="trimLines" aria-describedby="trimLines-help">
                        <label for="trimLines">Trim Lines</label>
                        <span id="trimLines-help" class="sr-only">When enabled, leading and trailing whitespace on each line is removed before comparison</span>
                    </div>
                    <div class="option-group">
                        <input type="checkbox" id="showChangesOnly" name="showChangesOnly" aria-describedby="showChangesOnly-help">
                        <label for="showChangesOnly">Changes Only</label>
                        <span id="showChangesOnly-help" class="sr-only">When enabled, only changed lines are shown, hiding unchanged content</span>
                    </div>
                </div>

                <div class="button-group" role="group" aria-label="Actions">
                    <button type="button" class="btn" onclick="compareDiff()" aria-label="Compare the two texts and show differences">
                        Compare
                    </button>
                    <button type="button" class="btn secondary" onclick="copyResults()" id="copyBtn" style="display: none;" aria-label="Copy diff results to clipboard">
                        Copy Results
                    </button>
                    <button type="button" class="btn tertiary" onclick="editMode()" id="editBtn" style="display: none;" aria-label="Return to edit mode to make changes">
                        Edit
                    </button>
                    <button type="button" class="btn tertiary" onclick="clearAll()" aria-label="Clear all text inputs and comparison results">
                        Clear All
                    </button>
                </div>
            </form>
        </div>

        <footer role="contentinfo">
            Text Diff Tool - Works offline, no installation required
        </footer>
    </main>

    <script>
        // Global state
        const state = {
            diffResult: null,
            mode: 'edit', // 'edit' or 'diff'
            originalText: { left: '', right: '' },
            isScrolling: false,
            currentChangeIndex: -1,
            changePositions: []
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupScrollSync();
            setupEditTracking();
            setupOptionListeners();
        });

        // Setup synchronized scrolling
        function setupScrollSync() {
            const leftPanel = document.getElementById('leftPanel');
            const rightPanel = document.getElementById('rightPanel');

            leftPanel.addEventListener('scroll', function() {
                if (state.isScrolling) return;
                if (!document.getElementById('syncScroll').checked) return;
                state.isScrolling = true;
                rightPanel.scrollTop = leftPanel.scrollTop;
                setTimeout(() => state.isScrolling = false, 50);
            });

            rightPanel.addEventListener('scroll', function() {
                if (state.isScrolling) return;
                if (!document.getElementById('syncScroll').checked) return;
                state.isScrolling = true;
                leftPanel.scrollTop = rightPanel.scrollTop;
                setTimeout(() => state.isScrolling = false, 50);
            });
        }

        // Track edits to return to edit mode if user types while in diff mode
        function setupEditTracking() {
            const leftPanel = document.getElementById('leftPanel');
            const rightPanel = document.getElementById('rightPanel');

            leftPanel.addEventListener('input', handleEdit);
            rightPanel.addEventListener('input', handleEdit);

            // Handle paste to strip formatting
            leftPanel.addEventListener('paste', handlePaste);
            rightPanel.addEventListener('paste', handlePaste);

            // Handle Ctrl+A to select only within panel
            leftPanel.addEventListener('keydown', handleSelectAll);
            rightPanel.addEventListener('keydown', handleSelectAll);
        }

        function handleEdit() {
            if (state.mode === 'diff') {
                // User started editing, switch back to edit mode
                editMode();
            }
        }

        function handlePaste(e) {
            e.preventDefault();
            const text = e.clipboardData.getData('text/plain');
            document.execCommand('insertText', false, text);
        }

        // Handle Ctrl+A to select only within the focused panel
        function handleSelectAll(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'a') {
                e.preventDefault();
                const selection = window.getSelection();
                const range = document.createRange();
                range.selectNodeContents(e.target);
                selection.removeAllRanges();
                selection.addRange(range);
            }
        }

        // Setup listeners for comparison options to auto-recompare
        function setupOptionListeners() {
            const comparisonOptions = ['ignoreWhitespace', 'ignoreCase', 'trimLines'];
            comparisonOptions.forEach(id => {
                document.getElementById(id).addEventListener('change', () => {
                    if (state.mode === 'diff' && state.originalText.left && state.originalText.right) {
                        // Re-run comparison with new options
                        recompareWithOptions();
                    }
                });
            });

            // Show changes only toggle
            document.getElementById('showChangesOnly').addEventListener('change', (e) => {
                if (state.mode === 'diff') {
                    toggleChangesOnly(e.target.checked);
                }
            });
        }

        // Toggle showing only changed lines
        function toggleChangesOnly(showOnlyChanges) {
            const leftPanel = document.getElementById('leftPanel');
            const rightPanel = document.getElementById('rightPanel');
            const unchangedLines = leftPanel.querySelectorAll('.diff-line.unchanged');
            const unchangedLinesRight = rightPanel.querySelectorAll('.diff-line.unchanged');

            unchangedLines.forEach(line => {
                line.classList.toggle('collapsed', showOnlyChanges);
            });
            unchangedLinesRight.forEach(line => {
                line.classList.toggle('collapsed', showOnlyChanges);
            });

            const mode = showOnlyChanges ? 'Showing changes only' : 'Showing all lines';
            A11yUtils.announce(mode, 'polite');
        }

        // Re-compare using stored original text
        function recompareWithOptions() {
            const options = {
                ignoreWhitespace: document.getElementById('ignoreWhitespace').checked,
                ignoreCase: document.getElementById('ignoreCase').checked,
                trimLines: document.getElementById('trimLines').checked
            };

            // Compute diff with new options
            state.diffResult = computeDiff(state.originalText.left, state.originalText.right, options);

            // Update stats
            updateStats(state.diffResult.stats);

            // Re-render
            renderInlineDiff(state.diffResult);

            // Reset navigation
            state.currentChangeIndex = -1;
            buildChangePositions();

            A11yUtils.announce(`Comparison updated. ${state.diffResult.stats.added} lines added, ${state.diffResult.stats.removed} lines removed`, 'polite');
        }

        // Get plain text from contenteditable
        function getTextContent(element) {
            // Clone the element to avoid modifying the original
            const clone = element.cloneNode(true);

            // Replace <br> and block elements with newlines
            const brs = clone.querySelectorAll('br');
            brs.forEach(br => br.replaceWith('\n'));

            const blocks = clone.querySelectorAll('div, p');
            blocks.forEach(block => {
                if (block.previousSibling) {
                    block.insertAdjacentText('beforebegin', '\n');
                }
            });

            return clone.textContent || '';
        }

        // Diff algorithm - Line-based comparison using LCS
        function computeDiff(text1, text2, options = {}) {
            const ignoreWhitespace = options.ignoreWhitespace || false;
            const ignoreCase = options.ignoreCase || false;
            const trimLines = options.trimLines || false;

            // Process text into lines
            let lines1 = text1.split('\n');
            let lines2 = text2.split('\n');

            // Apply options for comparison
            const processLine = (line) => {
                let processed = line;
                if (trimLines) processed = processed.trim();
                if (ignoreWhitespace) processed = processed.replace(/\s+/g, '');
                if (ignoreCase) processed = processed.toLowerCase();
                return processed;
            };

            const processed1 = lines1.map(processLine);
            const processed2 = lines2.map(processLine);

            // Compute LCS
            const lcs = computeLCS(processed1, processed2);

            // Build diff result
            const result = {
                lines: [],
                stats: {
                    added: 0,
                    removed: 0,
                    unchanged: 0
                }
            };

            let i = 0, j = 0, lcsIndex = 0;

            while (i < lines1.length || j < lines2.length) {
                if (lcsIndex < lcs.length &&
                    i < lines1.length &&
                    j < lines2.length &&
                    processed1[i] === lcs[lcsIndex] &&
                    processed2[j] === lcs[lcsIndex]) {
                    // Unchanged line
                    result.lines.push({
                        type: 'unchanged',
                        left: { line: lines1[i], number: i + 1 },
                        right: { line: lines2[j], number: j + 1 }
                    });
                    result.stats.unchanged++;
                    i++;
                    j++;
                    lcsIndex++;
                } else if (i < lines1.length &&
                          (lcsIndex >= lcs.length || processed1[i] !== lcs[lcsIndex])) {
                    // Removed line
                    result.lines.push({
                        type: 'removed',
                        left: { line: lines1[i], number: i + 1 },
                        right: null
                    });
                    result.stats.removed++;
                    i++;
                } else if (j < lines2.length) {
                    // Added line
                    result.lines.push({
                        type: 'added',
                        left: null,
                        right: { line: lines2[j], number: j + 1 }
                    });
                    result.stats.added++;
                    j++;
                }
            }

            return result;
        }

        // Longest Common Subsequence algorithm
        function computeLCS(arr1, arr2) {
            const m = arr1.length;
            const n = arr2.length;
            const dp = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));

            // Build LCS table
            for (let i = 1; i <= m; i++) {
                for (let j = 1; j <= n; j++) {
                    if (arr1[i - 1] === arr2[j - 1]) {
                        dp[i][j] = dp[i - 1][j - 1] + 1;
                    } else {
                        dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);
                    }
                }
            }

            // Backtrack to find LCS
            const lcs = [];
            let i = m, j = n;
            while (i > 0 && j > 0) {
                if (arr1[i - 1] === arr2[j - 1]) {
                    lcs.unshift(arr1[i - 1]);
                    i--;
                    j--;
                } else if (dp[i - 1][j] > dp[i][j - 1]) {
                    i--;
                } else {
                    j--;
                }
            }

            return lcs;
        }

        // Compute word-level diff between two lines
        function computeWordDiff(line1, line2) {
            // Split into words, preserving spaces
            const tokenize = (str) => {
                const tokens = [];
                let current = '';
                for (const char of str) {
                    if (/\s/.test(char)) {
                        if (current) tokens.push({ type: 'word', value: current });
                        tokens.push({ type: 'space', value: char });
                        current = '';
                    } else {
                        current += char;
                    }
                }
                if (current) tokens.push({ type: 'word', value: current });
                return tokens;
            };

            const tokens1 = tokenize(line1);
            const tokens2 = tokenize(line2);

            // Use LCS on tokens for word-level diff
            const values1 = tokens1.map(t => t.value);
            const values2 = tokens2.map(t => t.value);
            const lcs = computeLCS(values1, values2);

            // Build diff result
            const result1 = []; // For left panel (original)
            const result2 = []; // For right panel (modified)

            let i = 0, j = 0, lcsIndex = 0;

            while (i < tokens1.length || j < tokens2.length) {
                if (lcsIndex < lcs.length &&
                    i < tokens1.length &&
                    j < tokens2.length &&
                    tokens1[i].value === lcs[lcsIndex] &&
                    tokens2[j].value === lcs[lcsIndex]) {
                    // Unchanged token
                    result1.push({ value: tokens1[i].value, type: 'unchanged' });
                    result2.push({ value: tokens2[j].value, type: 'unchanged' });
                    i++; j++; lcsIndex++;
                } else if (i < tokens1.length &&
                          (lcsIndex >= lcs.length || tokens1[i].value !== lcs[lcsIndex])) {
                    // Removed token
                    result1.push({ value: tokens1[i].value, type: 'removed' });
                    i++;
                } else if (j < tokens2.length) {
                    // Added token
                    result2.push({ value: tokens2[j].value, type: 'added' });
                    j++;
                }
            }

            return { left: result1, right: result2 };
        }

        // Render word diff as HTML
        function renderWordDiff(tokens, side) {
            return tokens.map(token => {
                if (token.type === 'unchanged') {
                    return escapeHtml(token.value);
                } else if (token.type === 'removed' && side === 'left') {
                    return `<span class="word-removed">${escapeHtml(token.value)}</span>`;
                } else if (token.type === 'added' && side === 'right') {
                    return `<span class="word-added">${escapeHtml(token.value)}</span>`;
                }
                return escapeHtml(token.value);
            }).join('');
        }

        // Find matching line pairs for word-level diff
        function findLinePairs(diffResult) {
            const pairs = [];
            let i = 0;

            while (i < diffResult.lines.length) {
                const current = diffResult.lines[i];

                // Look for consecutive removed + added lines (indicates modification)
                if (current.type === 'removed' && i + 1 < diffResult.lines.length) {
                    const next = diffResult.lines[i + 1];
                    if (next.type === 'added') {
                        // These are likely a modified line pair
                        pairs.push({
                            leftIndex: i,
                            rightIndex: i + 1,
                            leftLine: current.left.line,
                            rightLine: next.right.line
                        });
                        i += 2;
                        continue;
                    }
                }
                i++;
            }

            return pairs;
        }

        // Compare and display diff
        function compareDiff() {
            const leftPanel = document.getElementById('leftPanel');
            const rightPanel = document.getElementById('rightPanel');

            // Store original text before switching to diff mode
            state.originalText.left = getTextContent(leftPanel);
            state.originalText.right = getTextContent(rightPanel);

            if (!state.originalText.left && !state.originalText.right) {
                alert('Please enter text to compare.');
                return;
            }

            const options = {
                ignoreWhitespace: document.getElementById('ignoreWhitespace').checked,
                ignoreCase: document.getElementById('ignoreCase').checked,
                trimLines: document.getElementById('trimLines').checked
            };

            // Compute diff
            state.diffResult = computeDiff(state.originalText.left, state.originalText.right, options);

            // Update stats
            updateStats(state.diffResult.stats);

            // Render diff inline
            renderInlineDiff(state.diffResult);

            // Switch to diff mode
            state.mode = 'diff';
            leftPanel.contentEditable = 'false';
            rightPanel.contentEditable = 'false';
            leftPanel.classList.add('diff-mode');
            rightPanel.classList.add('diff-mode');

            // Update status
            document.getElementById('leftStatus').textContent = 'Diff view';
            document.getElementById('rightStatus').textContent = 'Diff view';

            // Show results
            document.getElementById('statsSection').classList.add('show');
            document.getElementById('copyBtn').style.display = 'inline-block';
            document.getElementById('editBtn').style.display = 'inline-block';

            // Build navigation positions and show nav bar
            buildChangePositions();
            document.getElementById('navBar').classList.add('show');

            // Scroll to top
            leftPanel.scrollTop = 0;
            rightPanel.scrollTop = 0;

            // Announce to screen readers
            A11yUtils.announce(`Comparison complete. ${state.diffResult.stats.added} lines added, ${state.diffResult.stats.removed} lines removed. Use arrow keys to navigate changes.`, 'polite');
        }

        // Build list of change positions for navigation
        function buildChangePositions() {
            state.changePositions = [];
            state.currentChangeIndex = -1;

            if (!state.diffResult) return;

            state.diffResult.lines.forEach((item, index) => {
                if (item.type === 'added' || item.type === 'removed') {
                    state.changePositions.push(index);
                }
            });

            updateChangeCounter();
        }

        // Update the change counter display
        function updateChangeCounter() {
            const counter = document.getElementById('changeCounter');
            const total = state.changePositions.length;
            const current = state.currentChangeIndex >= 0 ? state.currentChangeIndex + 1 : 0;
            counter.textContent = `${current} / ${total}`;

            // Update button states
            document.getElementById('prevChange').disabled = state.currentChangeIndex <= 0;
            document.getElementById('nextChange').disabled = state.currentChangeIndex >= total - 1;
        }

        // Navigate to prev/next change
        function navigateChange(direction) {
            if (state.changePositions.length === 0) return;

            // Calculate new index
            let newIndex = state.currentChangeIndex + direction;

            // Clamp to valid range
            if (newIndex < 0) newIndex = 0;
            if (newIndex >= state.changePositions.length) newIndex = state.changePositions.length - 1;

            // If same index, return
            if (newIndex === state.currentChangeIndex) return;

            state.currentChangeIndex = newIndex;

            // Clear previous highlight
            document.querySelectorAll('.diff-line.current-change').forEach(el => {
                el.classList.remove('current-change');
            });

            // Highlight and scroll to current change
            const changeIndex = state.changePositions[newIndex];
            const leftLines = document.querySelectorAll('#leftPanel .diff-line');
            const rightLines = document.querySelectorAll('#rightPanel .diff-line');

            if (leftLines[changeIndex]) {
                leftLines[changeIndex].classList.add('current-change');
                leftLines[changeIndex].scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            if (rightLines[changeIndex]) {
                rightLines[changeIndex].classList.add('current-change');
            }

            updateChangeCounter();

            // Announce for screen readers
            const item = state.diffResult.lines[changeIndex];
            const type = item.type === 'added' ? 'Added' : 'Removed';
            A11yUtils.announce(`Change ${newIndex + 1} of ${state.changePositions.length}: ${type} line`, 'polite');
        }

        // Update statistics
        function updateStats(stats) {
            document.getElementById('linesAdded').textContent = stats.added;
            document.getElementById('linesRemoved').textContent = stats.removed;
            document.getElementById('linesUnchanged').textContent = stats.unchanged;
        }

        // Render diff inline in the panels with word-level highlighting
        function renderInlineDiff(diffResult) {
            const leftPanel = document.getElementById('leftPanel');
            const rightPanel = document.getElementById('rightPanel');

            leftPanel.innerHTML = '';
            rightPanel.innerHTML = '';

            // Pre-compute word diffs for modified line pairs
            const wordDiffs = new Map();
            for (let i = 0; i < diffResult.lines.length - 1; i++) {
                const current = diffResult.lines[i];
                const next = diffResult.lines[i + 1];

                // Look for consecutive removed + added (modified line)
                if (current.type === 'removed' && next.type === 'added' &&
                    current.left && next.right) {
                    const diff = computeWordDiff(current.left.line, next.right.line);
                    wordDiffs.set(i, { left: diff.left, type: 'removed-pair' });
                    wordDiffs.set(i + 1, { right: diff.right, type: 'added-pair' });
                }
            }

            diffResult.lines.forEach((item, index) => {
                // Get change indicator symbol
                const getIndicator = (type) => {
                    if (type === 'added') return '+';
                    if (type === 'removed') return '-';
                    return ' ';
                };

                // Left panel
                const leftLine = document.createElement('span');
                leftLine.className = 'diff-line';
                leftLine.dataset.index = index;

                if (item.left) {
                    leftLine.classList.add(item.type);
                    const indicator = `<span class="change-indicator">${getIndicator(item.type)}</span>`;
                    const lineNum = `<span class="line-number">${item.left.number}</span>`;

                    // Use word-level diff if available
                    if (wordDiffs.has(index) && wordDiffs.get(index).left) {
                        const wordDiffHtml = renderWordDiff(wordDiffs.get(index).left, 'left');
                        leftLine.innerHTML = `${lineNum}${indicator}${wordDiffHtml}\n`;
                    } else {
                        leftLine.innerHTML = `${lineNum}${indicator}${escapeHtml(item.left.line)}\n`;
                    }
                } else {
                    leftLine.classList.add('empty-placeholder');
                    leftLine.innerHTML = `<span class="line-number"></span><span class="change-indicator"></span>\n`;
                }
                leftPanel.appendChild(leftLine);

                // Right panel
                const rightLine = document.createElement('span');
                rightLine.className = 'diff-line';
                rightLine.dataset.index = index;

                if (item.right) {
                    rightLine.classList.add(item.type);
                    const indicator = `<span class="change-indicator">${getIndicator(item.type)}</span>`;
                    const lineNum = `<span class="line-number">${item.right.number}</span>`;

                    // Use word-level diff if available
                    if (wordDiffs.has(index) && wordDiffs.get(index).right) {
                        const wordDiffHtml = renderWordDiff(wordDiffs.get(index).right, 'right');
                        rightLine.innerHTML = `${lineNum}${indicator}${wordDiffHtml}\n`;
                    } else {
                        rightLine.innerHTML = `${lineNum}${indicator}${escapeHtml(item.right.line)}\n`;
                    }
                } else {
                    rightLine.classList.add('empty-placeholder');
                    rightLine.innerHTML = `<span class="line-number"></span><span class="change-indicator"></span>\n`;
                }
                rightPanel.appendChild(rightLine);
            });

            // Apply "changes only" filter if enabled
            if (document.getElementById('showChangesOnly').checked) {
                toggleChangesOnly(true);
            }
        }

        // Return to edit mode
        function editMode() {
            const leftPanel = document.getElementById('leftPanel');
            const rightPanel = document.getElementById('rightPanel');

            // Restore original text
            leftPanel.textContent = state.originalText.left;
            rightPanel.textContent = state.originalText.right;

            // Switch to edit mode
            state.mode = 'edit';
            leftPanel.contentEditable = 'true';
            rightPanel.contentEditable = 'true';
            leftPanel.classList.remove('diff-mode');
            rightPanel.classList.remove('diff-mode');

            // Update status
            document.getElementById('leftStatus').textContent = '';
            document.getElementById('rightStatus').textContent = '';

            // Hide edit button and nav bar
            document.getElementById('editBtn').style.display = 'none';
            document.getElementById('navBar').classList.remove('show');

            // Reset navigation state
            state.currentChangeIndex = -1;
            state.changePositions = [];

            A11yUtils.announce('Returned to edit mode', 'polite');
        }

        // Copy results to clipboard
        function copyResults() {
            if (!state.diffResult) return;

            let output = '=== DIFF RESULTS ===\n\n';
            output += `Lines Added: ${state.diffResult.stats.added}\n`;
            output += `Lines Removed: ${state.diffResult.stats.removed}\n`;
            output += `Lines Unchanged: ${state.diffResult.stats.unchanged}\n\n`;

            output += '=== UNIFIED DIFF ===\n\n';
            state.diffResult.lines.forEach(item => {
                if (item.type === 'removed') {
                    output += `- ${item.left.line}\n`;
                } else if (item.type === 'added') {
                    output += `+ ${item.right.line}\n`;
                } else {
                    output += `  ${item.left.line}\n`;
                }
            });

            navigator.clipboard.writeText(output).then(() => {
                A11yUtils.announce('Diff results copied to clipboard', 'polite');

                // Visual feedback
                const btn = document.getElementById('copyBtn');
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            }).catch(err => {
                alert('Failed to copy to clipboard: ' + err);
            });
        }

        // Clear all inputs and results
        function clearAll() {
            const leftPanel = document.getElementById('leftPanel');
            const rightPanel = document.getElementById('rightPanel');

            leftPanel.textContent = '';
            rightPanel.textContent = '';
            leftPanel.contentEditable = 'true';
            rightPanel.contentEditable = 'true';
            leftPanel.classList.remove('diff-mode');
            rightPanel.classList.remove('diff-mode');

            document.getElementById('ignoreWhitespace').checked = false;
            document.getElementById('ignoreCase').checked = false;
            document.getElementById('trimLines').checked = false;
            document.getElementById('showChangesOnly').checked = false;

            document.getElementById('statsSection').classList.remove('show');
            document.getElementById('copyBtn').style.display = 'none';
            document.getElementById('editBtn').style.display = 'none';
            document.getElementById('navBar').classList.remove('show');

            document.getElementById('leftStatus').textContent = '';
            document.getElementById('rightStatus').textContent = '';

            state.diffResult = null;
            state.mode = 'edit';
            state.originalText = { left: '', right: '' };
            state.currentChangeIndex = -1;
            state.changePositions = [];

            A11yUtils.announce('All fields cleared', 'polite');
        }

        // Escape HTML for display
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Allow keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + Enter to compare
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                compareDiff();
            }

            // Ctrl/Cmd + K to clear
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                clearAll();
            }

            // Escape to return to edit mode
            if (e.key === 'Escape' && state.mode === 'diff') {
                e.preventDefault();
                editMode();
            }

            // Arrow keys to navigate changes in diff mode
            if (state.mode === 'diff') {
                // Don't capture if user is in a text input
                const activeEl = document.activeElement;
                const isInPanel = activeEl.id === 'leftPanel' || activeEl.id === 'rightPanel';

                if (!isInPanel) {
                    if (e.key === 'ArrowDown' || e.key === 'ArrowRight' || e.key === 'j') {
                        e.preventDefault();
                        navigateChange(1);
                    } else if (e.key === 'ArrowUp' || e.key === 'ArrowLeft' || e.key === 'k') {
                        e.preventDefault();
                        navigateChange(-1);
                    }
                }
            }
        });
    </script>

    <script>
        document.querySelector('.skip-link').addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.getElementById('main-content');
            if (target) {
                target.setAttribute('tabindex', '-1');
                target.focus();
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });
    </script>
</body>
</html>
