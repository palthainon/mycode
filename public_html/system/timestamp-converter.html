<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- SEO Meta Tags -->
    <meta name="description" content="Convert log timestamps between formats. Parse syslog, ISO 8601, Unix epoch, and custom timestamp formats. Essential for log analysis.">
    <meta name="keywords" content="timestamp converter, log parser, date converter, epoch converter, syslog timestamp, ISO 8601, Unix time">
    <meta name="author" content="OldWeb LLC">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://oldweb.tech/system/timestamp-converter.html">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Log Timestamp Converter - OldWeb.tech">
    <meta property="og:description" content="Convert log timestamps between formats. Parse syslog, ISO 8601, Unix epoch, and custom timestamp formats. Essential for log analysis.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://oldweb.tech/system/timestamp-converter.html">
    <meta property="og:site_name" content="OldWeb.tech">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Log Timestamp Converter - OldWeb.tech">
    <meta name="twitter:description" content="Convert log timestamps between formats. Parse syslog, ISO 8601, Unix epoch, and custom timestamp formats. Essential for log analysis.">

    <!-- Additional Meta Tags -->
    <meta name="theme-color" content="#1a1a2e">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="../logo/favicon-32x32.png">

    <title>Log Timestamp Converter - OldWeb.tech</title>
    <link rel="stylesheet" href="../a11y.css">
    <script src="../a11y-utils.js"></script>
    <script src="../storage-utils.js"></script>
    <script src="../navigationv2.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 40px 20px;
            color: #fff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .ascii-logo {
            position: absolute;
            top: 20px;
            right: 40px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.65rem;
            line-height: 1.1;
            color: #4fc3f7;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.3);
            opacity: 0.8;
            white-space: pre;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
            color: #4fc3f7;
            text-shadow: 0 0 20px rgba(79, 195, 247, 0.3);
        }

        .calculator {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #90caf9;
            font-weight: 500;
        }

        .timestamp-input {
            width: 100%;
            min-height: 200px;
            max-height: 400px;
            padding: 12px 16px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            font-size: 0.95rem;
            font-family: 'Consolas', 'Monaco', monospace;
            transition: border-color 0.3s, box-shadow 0.3s;
            line-height: 1.6;
            resize: vertical;
        }

        .timestamp-input:focus {
            outline: none;
            border-color: #4fc3f7;
            box-shadow: 0 0 15px rgba(79, 195, 247, 0.2);
        }

        .timestamp-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .char-counter {
            text-align: right;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 5px;
        }

        .timezone-selectors {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .timezone-selectors select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            font-size: 0.9rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .timezone-selectors select:focus {
            outline: none;
            border-color: #4fc3f7;
            box-shadow: 0 0 15px rgba(79, 195, 247, 0.2);
        }

        .timezone-selectors select option {
            background: #1a1a2e;
            color: #fff;
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #4fc3f7 0%, #2196f3 100%);
            color: #fff;
            border: none;
            padding: 14px 40px;
            font-size: 1.1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
            flex: 1;
            min-width: 200px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(79, 195, 247, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #7e57c2 0%, #5e35b1 100%);
        }

        .btn-secondary:hover {
            box-shadow: 0 5px 20px rgba(126, 87, 194, 0.4);
        }

        .results {
            display: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .results.show {
            display: block;
            opacity: 1;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .results-summary {
            color: #90caf9;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .export-btn {
            background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%);
            color: #fff;
            border: none;
            padding: 10px 25px;
            font-size: 0.95rem;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 187, 106, 0.4);
        }

        .export-btn:active {
            transform: translateY(0);
        }

        .results-table-container {
            max-height: 600px;
            overflow-y: auto;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
        }

        .results-table thead {
            position: sticky;
            top: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            z-index: 10;
        }

        .results-table th {
            padding: 12px;
            text-align: left;
            color: #4fc3f7;
            font-weight: 600;
            font-size: 0.9rem;
            border-bottom: 2px solid rgba(79, 195, 247, 0.3);
        }

        .results-table td {
            padding: 12px;
            font-size: 0.85rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .results-table tbody tr {
            background: rgba(255, 255, 255, 0.02);
            transition: background 0.2s;
        }

        .results-table tbody tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.05);
        }

        .results-table tbody tr:hover {
            background: rgba(79, 195, 247, 0.1);
        }

        .results-table tbody tr.valid {
            border-left: 3px solid #66bb6a;
        }

        .results-table tbody tr.error {
            border-left: 3px solid #f44336;
            background: rgba(244, 67, 54, 0.05);
        }

        .timestamp-cell {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.8rem;
            color: #90caf9;
            word-break: break-all;
            max-width: 300px;
        }

        .format-cell {
            color: #66bb6a;
            font-weight: 500;
        }

        .error-cell {
            color: #ff8a80;
        }

        .conversion-cell {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.8rem;
        }

        .conversion-row {
            display: block;
            margin: 3px 0;
        }

        .conversion-label {
            display: inline-block;
            min-width: 80px;
            color: #90caf9;
            font-weight: 500;
        }

        .conversion-value {
            color: #fff;
        }

        .copy-btn {
            background: rgba(79, 195, 247, 0.2);
            border: 1px solid rgba(79, 195, 247, 0.3);
            color: #4fc3f7;
            padding: 2px 8px;
            font-size: 0.7rem;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 8px;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: rgba(79, 195, 247, 0.3);
            border-color: #4fc3f7;
        }

        .copy-btn.copied {
            background: rgba(102, 187, 106, 0.3);
            border-color: #66bb6a;
            color: #66bb6a;
        }

        .error {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid #f44336;
            color: #ff8a80;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .error.show {
            display: block;
        }

        footer {
            text-align: center;
            margin-top: 50px;
            color: rgba(255, 255, 255, 0.4);
            font-size: 0.85rem;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn.secondary {
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #90caf9;
            margin-top: 10px;
        }
        .btn.secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: none;
            transform: none;
        }

        .nav-bar {
            position: absolute;
            top: 20px;
            left: 40px;
            display: flex;
            gap: 15px;
            align-items: center;
            z-index: 100;
        }

        .nav-link {
            color: #4fc3f7;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 600;
            transition: color 0.2s, text-shadow 0.2s;
        }

        .nav-link:hover {
            color: #2196f3;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
        }

        .nav-link.current {
            color: #66bb6a;
            border-bottom: 2px solid #66bb6a;
        }

        .nav-separator {
            color: rgba(79, 195, 247, 0.3);
            user-select: none;
        }

        @media (max-width: 768px) {
            .nav-bar {
                position: static;
                justify-content: center;
                flex-wrap: wrap;
                margin-bottom: 20px;
                gap: 10px;
            }

            .ascii-logo {
                position: static;
                text-align: center;
                margin-bottom: 20px;
                font-size: 0.5rem;
            }

            h1 {
                font-size: 2rem;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                min-width: 100%;
            }

            .results-table {
                font-size: 0.75rem;
            }

            .results-table th,
            .results-table td {
                padding: 8px;
            }
        }
    </style>

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Log Timestamp Converter",
      "description": "Convert log timestamps between formats. Parse syslog, ISO 8601, Unix epoch, and custom timestamp formats. Essential for log analysis.",
      "url": "https://oldweb.tech/timestamp-converter.html",
      "applicationCategory": "UtilitiesApplication",
      "operatingSystem": "Web Browser",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "creator": {
        "@type": "Organization",
        "name": "OldWeb.tech"
      }
    }
    </script>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div class="ascii-logo" aria-hidden="true">  ___  _    _  __        __   _
 / _ \| | _| | \ \      / /__| |__
| | | | |/ _` | \ \ /\ / / _ \ '_ \
| |_| | | (_| |  \ V  V /  __/ |_) |
 \___/|_|\__,_|   \_/\_/ \___|_.__/
</div>
    <main id="main-content" class="container">
        <h1>Log Timestamp Converter</h1>

        <div class="calculator">
            <div class="error" id="errorMsg" role="alert" aria-live="assertive" aria-atomic="true"></div>

            <form aria-label="Timestamp converter form">
            <div class="input-group">
                <label for="timestampInput">Paste timestamps (one per line):</label>
                <textarea
                    id="timestampInput"
                    class="timestamp-input"
                    placeholder="2024-01-07T15:30:00Z&#10;Jan  7 15:30:00 router1 kernel: eth0 link up&#10;07/Jan/2024:15:30:00 +0000&#10;1704641400&#10;1/7/2024 3:30:00 PM"
                    aria-required="true"
                    aria-describedby="timestamp-help char-counter"></textarea>
                <span id="timestamp-help" class="sr-only">Enter log timestamps in any format, one per line. Supports ISO 8601, Unix epoch, syslog, Apache, and custom formats</span>
                <div class="char-counter" id="charCounter" aria-live="polite">0 lines | 0 characters</div>
            </div>

            <div class="input-group">
                <label id="timezone-label">Additional Timezones (optional):</label>
                <div class="timezone-selectors" role="group" aria-labelledby="timezone-label">
                    <select id="tz1" aria-label="Additional timezone 1 for conversion">
                        <option value="">-- Timezone 1 --</option>
                        <option value="America/New_York">US Eastern</option>
                        <option value="America/Chicago">US Central</option>
                        <option value="America/Denver">US Mountain</option>
                        <option value="America/Los_Angeles">US Pacific</option>
                        <option value="Europe/London">London (GMT/BST)</option>
                        <option value="Europe/Paris">Paris (CET/CEST)</option>
                        <option value="Europe/Berlin">Berlin (CET/CEST)</option>
                        <option value="Asia/Tokyo">Tokyo (JST)</option>
                        <option value="Asia/Shanghai">Shanghai (CST)</option>
                        <option value="Asia/Dubai">Dubai (GST)</option>
                        <option value="Asia/Singapore">Singapore (SGT)</option>
                        <option value="Australia/Sydney">Sydney (AEDT/AEST)</option>
                        <option value="Pacific/Auckland">Auckland (NZDT/NZST)</option>
                    </select>
                    <select id="tz2" aria-label="Additional timezone 2 for conversion">
                        <option value="">-- Timezone 2 --</option>
                        <option value="America/New_York">US Eastern</option>
                        <option value="America/Chicago">US Central</option>
                        <option value="America/Denver">US Mountain</option>
                        <option value="America/Los_Angeles">US Pacific</option>
                        <option value="Europe/London">London (GMT/BST)</option>
                        <option value="Europe/Paris">Paris (CET/CEST)</option>
                        <option value="Europe/Berlin">Berlin (CET/CEST)</option>
                        <option value="Asia/Tokyo">Tokyo (JST)</option>
                        <option value="Asia/Shanghai">Shanghai (CST)</option>
                        <option value="Asia/Dubai">Dubai (GST)</option>
                        <option value="Asia/Singapore">Singapore (SGT)</option>
                        <option value="Australia/Sydney">Sydney (AEDT/AEST)</option>
                        <option value="Pacific/Auckland">Auckland (NZDT/NZST)</option>
                    </select>
                    <select id="tz3" aria-label="Additional timezone 3 for conversion">
                        <option value="">-- Timezone 3 --</option>
                        <option value="America/New_York">US Eastern</option>
                        <option value="America/Chicago">US Central</option>
                        <option value="America/Denver">US Mountain</option>
                        <option value="America/Los_Angeles">US Pacific</option>
                        <option value="Europe/London">London (GMT/BST)</option>
                        <option value="Europe/Paris">Paris (CET/CEST)</option>
                        <option value="Europe/Berlin">Berlin (CET/CEST)</option>
                        <option value="Asia/Tokyo">Tokyo (JST)</option>
                        <option value="Asia/Shanghai">Shanghai (CST)</option>
                        <option value="Asia/Dubai">Dubai (GST)</option>
                        <option value="Asia/Singapore">Singapore (SGT)</option>
                        <option value="Australia/Sydney">Sydney (AEDT/AEST)</option>
                        <option value="Pacific/Auckland">Auckland (NZDT/NZST)</option>
                    </select>
                </div>
            </div>

            <div class="button-group">
                <button type="button" class="btn" onclick="convertTimestamps()" aria-label="Convert all entered timestamps to multiple timezone formats">Convert Timestamps</button>
                <button type="button" class="btn btn-secondary" onclick="loadSampleData()" aria-label="Load sample log timestamps for testing">Load Sample Data</button>
            </div>

            <button type="button" class="btn secondary" onclick="clearAllSavedData()" aria-label="Clear all saved form data from this page">Clear Saved Data</button>
            </form>
        </div>

        <div class="results" id="results" role="region" aria-live="polite" aria-label="Timestamp conversion results">
            <div class="calculator">
                <div class="results-header">
                    <div class="results-summary" id="resultsSummary"></div>
                    <button type="button" class="export-btn" onclick="exportToCSV()" aria-label="Export timestamp conversions to CSV file">Export to CSV</button>
                </div>
                <div class="results-table-container">
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>Line</th>
                                <th>Original</th>
                                <th>Detected Format</th>
                                <th>Conversions</th>
                            </tr>
                        </thead>
                        <tbody id="resultsBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <footer role="contentinfo">
            Log Timestamp Converter - Supports ISO8601, RFC3339, Syslog, Apache/Nginx, Windows Event Log, and Unix formats
        </footer>
    </main>

    <script>
        let resultsData = [];

        // Regex patterns for timestamp detection
        const patterns = {
            iso8601: /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|[+-]\d{2}:\d{2})$/,
            iso8601_simple: /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}$/,
            unixMs: /^\d{13}$/,
            unixSec: /^\d{10}$/,
            apache: /^\d{2}\/[A-Za-z]{3}\/\d{4}:\d{2}:\d{2}:\d{2}\s+[+-]\d{4}$/,
            windows: /^\d{1,2}\/\d{1,2}\/\d{4}\s+\d{1,2}:\d{2}:\d{2}\s+(AM|PM)$/i,
            syslog: /^[A-Za-z]{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}$/,
            commonDate: /^[A-Za-z]{3}\s+[A-Za-z]{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}\s+\d{4}$/
        };

        const monthMap = {
            'Jan': 0, 'Feb': 1, 'Mar': 2, 'Apr': 3, 'May': 4, 'Jun': 5,
            'Jul': 6, 'Aug': 7, 'Sep': 8, 'Oct': 9, 'Nov': 10, 'Dec': 11
        };

        // Update character counter
        document.getElementById('timestampInput').addEventListener('input', updateCharCounter);

        function updateCharCounter() {
            const input = document.getElementById('timestampInput').value;
            const lines = input.split('\n').filter(line => line.trim().length > 0);
            const chars = input.length;
            document.getElementById('charCounter').textContent =
                `${lines.length} lines | ${chars.toLocaleString()} characters`;
        }

        // Keyboard shortcut: Ctrl/Cmd + Enter to convert
        document.getElementById('timestampInput').addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                convertTimestamps();
            }
        });

        function detectAndParse(timestampStr) {
            const ts = timestampStr.trim();

            // ISO8601/RFC3339
            if (patterns.iso8601.test(ts) || patterns.iso8601_simple.test(ts)) {
                const date = new Date(ts);
                if (!isNaN(date.getTime())) {
                    return { format: 'ISO8601/RFC3339', date: date };
                }
            }

            // Unix milliseconds
            if (patterns.unixMs.test(ts)) {
                const date = new Date(parseInt(ts));
                if (!isNaN(date.getTime())) {
                    return { format: 'Unix (milliseconds)', date: date };
                }
            }

            // Unix seconds
            if (patterns.unixSec.test(ts)) {
                const epoch = parseInt(ts);
                if (epoch >= 946684800 && epoch <= 2147483647) {
                    const date = new Date(epoch * 1000);
                    return { format: 'Unix (seconds)', date: date };
                }
            }

            // Apache/Nginx common log format
            if (patterns.apache.test(ts)) {
                const match = ts.match(/^(\d{2})\/([A-Za-z]{3})\/(\d{4}):(\d{2}):(\d{2}):(\d{2})\s+([+-]\d{4})$/);
                if (match) {
                    const [, day, month, year, hour, minute, second, tz] = match;
                    const monthNum = monthMap[month];
                    if (monthNum !== undefined) {
                        const tzOffset = parseInt(tz.substring(1, 3)) * 60 + parseInt(tz.substring(3));
                        const tzMinutes = tz[0] === '+' ? -tzOffset : tzOffset;
                        const date = new Date(Date.UTC(
                            parseInt(year), monthNum, parseInt(day),
                            parseInt(hour), parseInt(minute), parseInt(second)
                        ));
                        date.setMinutes(date.getMinutes() + tzMinutes);
                        return { format: 'Apache/Nginx Log', date: date };
                    }
                }
            }

            // Windows Event Log
            if (patterns.windows.test(ts)) {
                const date = new Date(ts);
                if (!isNaN(date.getTime())) {
                    return { format: 'Windows Event Log', date: date };
                }
            }

            // Syslog format (no year)
            if (patterns.syslog.test(ts)) {
                const match = ts.match(/^([A-Za-z]{3})\s+(\d{1,2})\s+(\d{2}):(\d{2}):(\d{2})$/);
                if (match) {
                    const [, month, day, hour, minute, second] = match;
                    const monthNum = monthMap[month];
                    if (monthNum !== undefined) {
                        const currentYear = new Date().getFullYear();
                        const date = new Date(currentYear, monthNum, parseInt(day),
                            parseInt(hour), parseInt(minute), parseInt(second));
                        return {
                            format: 'Syslog (assumed year: ' + currentYear + ')',
                            date: date
                        };
                    }
                }
            }

            // Common date string format
            if (patterns.commonDate.test(ts)) {
                const date = new Date(ts);
                if (!isNaN(date.getTime())) {
                    return { format: 'Common Date String', date: date };
                }
            }

            // Try generic Date parsing as last resort
            const date = new Date(ts);
            if (!isNaN(date.getTime()) && ts.length > 8) {
                return { format: 'Generic Date', date: date };
            }

            return { format: 'Unknown', date: null, error: 'Unable to detect timestamp format' };
        }

        function convertTimestamps() {
            hideError();
            const input = document.getElementById('timestampInput').value;
            const lines = input.split('\n').filter(line => line.trim().length > 0);

            if (lines.length === 0) {
                showError('Please paste at least one timestamp');
                return;
            }

            const maxLines = 1000;
            const processLines = lines.slice(0, maxLines);

            if (lines.length > maxLines) {
                showError(`Processing first ${maxLines} of ${lines.length} timestamps (max limit reached)`);
            }

            resultsData = processLines.map((line, index) => {
                const detection = detectAndParse(line);
                if (detection.date && !isNaN(detection.date.getTime())) {
                    return {
                        index: index + 1,
                        original: line,
                        format: detection.format,
                        date: detection.date,
                        valid: true
                    };
                } else {
                    return {
                        index: index + 1,
                        original: line,
                        format: detection.format,
                        error: detection.error || 'Invalid date',
                        valid: false
                    };
                }
            });

            displayResults();
        }

        function displayResults() {
            const validCount = resultsData.filter(r => r.valid).length;
            const errorCount = resultsData.filter(r => !r.valid).length;

            document.getElementById('resultsSummary').textContent =
                `${validCount} converted, ${errorCount} error${errorCount !== 1 ? 's' : ''}`;

            const tbody = document.getElementById('resultsBody');
            tbody.innerHTML = '';

            const tz1 = document.getElementById('tz1').value;
            const tz2 = document.getElementById('tz2').value;
            const tz3 = document.getElementById('tz3').value;

            resultsData.forEach(result => {
                const row = document.createElement('tr');
                row.className = result.valid ? 'valid' : 'error';

                const lineCell = document.createElement('td');
                lineCell.textContent = result.index;
                row.appendChild(lineCell);

                const originalCell = document.createElement('td');
                originalCell.className = 'timestamp-cell';
                const truncated = result.original.length > 100
                    ? result.original.substring(0, 100) + '...'
                    : result.original;
                originalCell.textContent = truncated;
                originalCell.title = result.original;
                row.appendChild(originalCell);

                const formatCell = document.createElement('td');
                formatCell.className = result.valid ? 'format-cell' : 'error-cell';
                formatCell.textContent = result.format;
                row.appendChild(formatCell);

                const conversionCell = document.createElement('td');
                conversionCell.className = 'conversion-cell';

                if (result.valid) {
                    const conversions = [];

                    // ISO8601
                    conversions.push(createConversionRow('ISO8601', result.date.toISOString()));

                    // Unix seconds
                    conversions.push(createConversionRow('Unix (s)',
                        Math.floor(result.date.getTime() / 1000).toString()));

                    // Unix milliseconds
                    conversions.push(createConversionRow('Unix (ms)',
                        result.date.getTime().toString()));

                    // Human readable
                    conversions.push(createConversionRow('Human',
                        result.date.toLocaleString('en-US', {
                            year: 'numeric',
                            month: 'short',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit',
                            hour12: false
                        })));

                    // UTC
                    conversions.push(createConversionRow('UTC', formatTimezone(result.date, 'UTC')));

                    // Local
                    conversions.push(createConversionRow('Local',
                        result.date.toLocaleString('en-US', {
                            year: 'numeric',
                            month: 'short',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit',
                            hour12: false,
                            timeZoneName: 'short'
                        })));

                    // Additional timezones
                    if (tz1) {
                        conversions.push(createConversionRow(tz1.split('/')[1], formatTimezone(result.date, tz1)));
                    }
                    if (tz2) {
                        conversions.push(createConversionRow(tz2.split('/')[1], formatTimezone(result.date, tz2)));
                    }
                    if (tz3) {
                        conversions.push(createConversionRow(tz3.split('/')[1], formatTimezone(result.date, tz3)));
                    }

                    conversionCell.innerHTML = conversions.join('');
                } else {
                    conversionCell.innerHTML = `<span class="error-cell">âš  ${result.error}</span>`;
                }

                row.appendChild(conversionCell);
                tbody.appendChild(row);
            });

            const resultsDiv = document.getElementById('results');
            resultsDiv.classList.add('show');
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            // Announce results
            const validCount = resultsData.filter(r => !r.error).length;
            const errorCount = resultsData.filter(r => r.error).length;
            let announcement = `Conversion complete. ${validCount} timestamp${validCount !== 1 ? 's' : ''} converted successfully`;
            if (errorCount > 0) {
                announcement += `, ${errorCount} error${errorCount !== 1 ? 's' : ''}`;
            }
            A11yUtils.announce(announcement, 'polite');
        }

        function createConversionRow(label, value) {
            return `<div class="conversion-row">
                <span class="conversion-label">${label}:</span>
                <span class="conversion-value">${value}</span>
                <button class="copy-btn" onclick="copyToClipboard('${escapeHtml(value)}', this)">Copy</button>
            </div>`;
        }

        function formatTimezone(date, tzName) {
            try {
                const formatter = new Intl.DateTimeFormat('en-US', {
                    timeZone: tzName,
                    year: 'numeric',
                    month: 'short',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false,
                    timeZoneName: 'short'
                });
                return formatter.format(date);
            } catch (e) {
                return 'Invalid timezone';
            }
        }

        function copyToClipboard(text, button) {
            const unescaped = text.replace(/&quot;/g, '"')
                                  .replace(/&#39;/g, "'")
                                  .replace(/&amp;/g, '&')
                                  .replace(/&lt;/g, '<')
                                  .replace(/&gt;/g, '>');

            navigator.clipboard.writeText(unescaped).then(() => {
                button.textContent = 'Copied!';
                button.classList.add('copied');
                A11yUtils.announce('Copied timestamp to clipboard', 'polite');
                setTimeout(() => {
                    button.textContent = 'Copy';
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function exportToCSV() {
            if (resultsData.length === 0) return;

            const tz1 = document.getElementById('tz1').value;
            const tz2 = document.getElementById('tz2').value;
            const tz3 = document.getElementById('tz3').value;

            const headers = [
                'Line', 'Original', 'Detected Format', 'ISO8601',
                'Unix Seconds', 'Unix Milliseconds', 'Human Readable', 'UTC', 'Local'
            ];

            if (tz1) headers.push(tz1.split('/')[1] || tz1);
            if (tz2) headers.push(tz2.split('/')[1] || tz2);
            if (tz3) headers.push(tz3.split('/')[1] || tz3);

            const rows = [headers];

            resultsData.forEach(result => {
                if (result.valid) {
                    const row = [
                        result.index,
                        escapeCSV(result.original),
                        escapeCSV(result.format),
                        result.date.toISOString(),
                        Math.floor(result.date.getTime() / 1000),
                        result.date.getTime(),
                        escapeCSV(result.date.toLocaleString('en-US')),
                        escapeCSV(formatTimezone(result.date, 'UTC')),
                        escapeCSV(result.date.toLocaleString('en-US', { timeZoneName: 'short' }))
                    ];

                    if (tz1) row.push(escapeCSV(formatTimezone(result.date, tz1)));
                    if (tz2) row.push(escapeCSV(formatTimezone(result.date, tz2)));
                    if (tz3) row.push(escapeCSV(formatTimezone(result.date, tz3)));

                    rows.push(row);
                } else {
                    const row = [
                        result.index,
                        escapeCSV(result.original),
                        'ERROR',
                        escapeCSV(result.error),
                        '', '', '', '', ''
                    ];
                    if (tz1) row.push('');
                    if (tz2) row.push('');
                    if (tz3) row.push('');
                    rows.push(row);
                }
            });

            const csv = rows.map(row => row.join(',')).join('\n');
            const filename = `timestamp-conversions-${new Date().toISOString().split('T')[0]}.csv`;
            downloadFile(csv, filename, 'text/csv;charset=utf-8;');
            A11yUtils.announce(`Exported ${resultsData.length} timestamp conversions to CSV file`, 'polite');
        }

        function escapeCSV(str) {
            if (str === null || str === undefined) return '';
            const s = String(str);
            if (s.includes(',') || s.includes('"') || s.includes('\n')) {
                return '"' + s.replace(/"/g, '""') + '"';
            }
            return s;
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function loadSampleData() {
            const sample = `2024-01-07T15:30:00Z
2024-01-07T15:30:00.123+00:00
Jan  7 15:30:00 router1 kernel: eth0 link up
Jan 15 08:45:22 switch1 %LINK-3-UPDOWN: Interface Gi0/1 changed state
07/Jan/2024:15:30:00 +0000 GET /index.html 200
1704641400
1704641400000
1/7/2024 3:30:00 PM Application started successfully
Mon Jan 07 15:30:00 2024
12/31/2025 11:59:59 PM New Year's Eve log entry`;

            document.getElementById('timestampInput').value = sample;
            updateCharCounter();
            A11yUtils.announce('Loaded sample log timestamps', 'polite');
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMsg');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
        }

        function hideError() {
            const errorDiv = document.getElementById('errorMsg');
            errorDiv.classList.remove('show');
        }

        // localStorage persistence
        const timestampConverterFields = ['timestampInput', 'tz1', 'tz2', 'tz3'];

        function clearAllSavedData() {
            StorageUtils.remove('timestamp-converter');
            // Reset to defaults
            document.getElementById('timestampInput').value = '';
            document.getElementById('tz1').selectedIndex = 0;
            document.getElementById('tz2').selectedIndex = 0;
            document.getElementById('tz3').selectedIndex = 0;
            // Clear results
            document.getElementById('results').classList.remove('show');
            updateCharCounter();
            A11yUtils.announce('All saved data has been cleared', 'polite');
        }

        document.addEventListener('DOMContentLoaded', function() {
            StorageUtils.loadFormInputs('timestamp-converter', timestampConverterFields, function() {
                // After loading, update char counter
                updateCharCounter();
            });
            StorageUtils.autoSaveFormInputs('timestamp-converter', timestampConverterFields);
        });
    </script>
    <script>
        document.querySelector('.skip-link').addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.getElementById('main-content');
            if (target) {
                target.setAttribute('tabindex', '-1');
                target.focus();
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });
    </script>
</body>
</html>
