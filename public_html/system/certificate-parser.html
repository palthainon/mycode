<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- SEO Meta Tags -->
    <meta name="description" content="Parse and decode PEM certificates and CSRs. View expiry dates, subject, issuer, and SANs. Generate certificate signing requests online.">
    <meta name="keywords" content="certificate parser, PEM decoder, CSR generator, SSL certificate, X.509, certificate info, SAN, subject alternative name">
    <meta name="author" content="OldWeb LLC">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://oldweb.tech/system/certificate-parser.html">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Certificate Parser - OldWeb.tech">
    <meta property="og:description" content="Parse and decode PEM certificates and CSRs. View expiry dates, subject, issuer, and SANs. Generate certificate signing requests online.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://oldweb.tech/system/certificate-parser.html">
    <meta property="og:site_name" content="OldWeb.tech">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Certificate Parser - OldWeb.tech">
    <meta name="twitter:description" content="Parse and decode PEM certificates and CSRs. View expiry dates, subject, issuer, and SANs. Generate certificate signing requests online.">

    <!-- Additional Meta Tags -->
    <meta name="theme-color" content="#1a1a2e">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="../logo/favicon-32x32.png">

    <title>Certificate Parser - OldWeb.tech</title>
    <link rel="stylesheet" href="../a11y.css">
    <script src="../a11y-utils.js"></script>
    <script src="../storage-utils.js"></script>
    <script src="../navigationv2.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 40px 20px;
            color: #fff;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .ascii-logo {
            position: absolute;
            top: 20px;
            right: 40px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.65rem;
            line-height: 1.1;
            color: #4fc3f7;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.3);
            opacity: 0.8;
            white-space: pre;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5rem;
            color: #4fc3f7;
            text-shadow: 0 0 20px rgba(79, 195, 247, 0.3);
        }

        .subtitle {
            text-align: center;
            color: #90caf9;
            font-size: 1rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.2);
            padding: 5px;
            border-radius: 12px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: #90caf9;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            background: rgba(79, 195, 247, 0.1);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #4fc3f7 0%, #2196f3 100%);
            color: #1a1a2e;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .calculator {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 0.9rem;
            color: #90caf9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 15px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            font-size: 0.85rem;
            color: #90caf9;
            margin-bottom: 8px;
        }

        .input-group textarea,
        .input-group input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(79, 195, 247, 0.3);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .input-group textarea {
            min-height: 200px;
            resize: vertical;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #4fc3f7;
            box-shadow: 0 0 10px rgba(79, 195, 247, 0.3);
        }

        .btn-row {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .primary-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #4fc3f7 0%, #2196f3 100%);
            border: none;
            border-radius: 8px;
            color: #1a1a2e;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .primary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 195, 247, 0.4);
        }

        .secondary-btn {
            padding: 12px 24px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(79, 195, 247, 0.3);
            border-radius: 8px;
            color: #90caf9;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .secondary-btn:hover {
            background: rgba(79, 195, 247, 0.1);
            border-color: #4fc3f7;
        }

        .results-section {
            display: none;
        }

        .results-section.show {
            display: block;
        }

        .result-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #4fc3f7;
            margin-bottom: 15px;
        }

        .result-card h4 {
            font-size: 0.8rem;
            color: #90caf9;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .result-card .value {
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .result-card .value code {
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            color: #4fc3f7;
            flex: 1;
            word-break: break-all;
        }

        .result-card .value.valid {
            border-left-color: #66bb6a;
        }

        .result-card .value.expired {
            border-left-color: #f44336;
        }

        .result-card.valid {
            border-left-color: #66bb6a;
        }

        .result-card.expired {
            border-left-color: #f44336;
        }

        .result-card.warning {
            border-left-color: #ff9800;
        }

        .copy-btn {
            padding: 6px 12px;
            background: rgba(102, 187, 106, 0.2);
            border: 1px solid #66bb6a;
            border-radius: 6px;
            color: #66bb6a;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .copy-btn:hover {
            background: rgba(102, 187, 106, 0.3);
        }

        .copy-btn.copied {
            background: #66bb6a;
            color: #1a1a2e;
        }

        .san-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .san-list li {
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            margin-bottom: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #4fc3f7;
        }

        .san-list li:last-child {
            margin-bottom: 0;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-badge.valid {
            background: rgba(102, 187, 106, 0.2);
            color: #66bb6a;
            border: 1px solid #66bb6a;
        }

        .status-badge.expired {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
            border: 1px solid #f44336;
        }

        .status-badge.expiring {
            background: rgba(255, 152, 0, 0.2);
            color: #ff9800;
            border: 1px solid #ff9800;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        #certError, #csrError, #genError {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid #f44336;
            border-left: 4px solid #f44336;
            color: #ff8a80;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        #certError.show, #csrError.show, #genError.show {
            display: block;
        }

        input.error, textarea.error {
            border-color: #f44336 !important;
        }

        .csr-form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .csr-form-grid .input-group {
            margin-bottom: 0;
        }

        .san-input-container {
            margin-bottom: 20px;
        }

        .san-inputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .san-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .san-row input {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid rgba(79, 195, 247, 0.3);
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .san-row input:focus {
            outline: none;
            border-color: #4fc3f7;
        }

        .san-row .remove-san {
            padding: 8px 12px;
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
            border-radius: 6px;
            color: #f44336;
            cursor: pointer;
            font-size: 1rem;
            line-height: 1;
        }

        .san-row .remove-san:hover {
            background: rgba(244, 67, 54, 0.3);
        }

        .add-san-btn {
            padding: 8px 16px;
            background: rgba(79, 195, 247, 0.1);
            border: 1px dashed rgba(79, 195, 247, 0.5);
            border-radius: 6px;
            color: #4fc3f7;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .add-san-btn:hover {
            background: rgba(79, 195, 247, 0.2);
            border-style: solid;
        }

        .key-options {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .key-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .key-option input[type="radio"] {
            accent-color: #4fc3f7;
        }

        .key-option label {
            color: #90caf9;
            cursor: pointer;
        }

        .output-section {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .output-section.show {
            display: block;
        }

        .output-section h4 {
            color: #90caf9;
            margin-bottom: 15px;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .output-section textarea {
            width: 100%;
            min-height: 150px;
            padding: 12px;
            border: 1px solid rgba(79, 195, 247, 0.3);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: #4fc3f7;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            resize: vertical;
        }

        .output-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .dn-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }

        .dn-item {
            display: flex;
            margin-bottom: 8px;
        }

        .dn-item:last-child {
            margin-bottom: 0;
        }

        .dn-label {
            color: #90caf9;
            min-width: 40px;
            font-size: 0.85rem;
        }

        .dn-value {
            color: #4fc3f7;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header .section-title {
            margin-bottom: 0;
        }

        .export-btn {
            background: linear-gradient(135deg, #66bb6a 0%, #43a047 100%);
            color: #fff;
            border: none;
            padding: 10px 20px;
            font-size: 0.9rem;
            border-radius: 6px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
            display: inline-block;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 187, 106, 0.4);
        }

        .export-btn:active {
            transform: translateY(0);
        }

        .export-btn:focus {
            outline: 3px solid #4fc3f7;
            outline-offset: 2px;
        }

        .tab-btn:focus {
            outline: 3px solid #4fc3f7;
            outline-offset: 2px;
        }

        footer {
            text-align: center;
            margin-top: 30px;
            color: rgba(255, 255, 255, 0.4);
            font-size: 0.85rem;
        }

        .btn.secondary {
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #90caf9;
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 0.9rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: block;
            width: 100%;
        }
        .btn.secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: none;
            transform: none;
        }

        @media (max-width: 768px) {
            .ascii-logo {
                position: static;
                text-align: center;
                margin-bottom: 20px;
                font-size: 0.5rem;
            }

            h1 {
                font-size: 1.8rem;
            }

            .tabs {
                flex-direction: column;
            }

            .btn-row {
                flex-direction: column;
            }

            .key-options {
                flex-direction: column;
                gap: 10px;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }

            .csr-form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Certificate Parser",
      "description": "Parse and decode PEM certificates and CSRs. View expiry dates, subject, issuer, and SANs. Generate certificate signing requests online.",
      "url": "https://oldweb.tech/system/certificate-parser.html",
      "applicationCategory": "UtilitiesApplication",
      "operatingSystem": "Web Browser",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "creator": {
        "@type": "Organization",
        "name": "OldWeb.tech"
      }
    }
    </script>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div class="ascii-logo" aria-hidden="true">  ___  _    _  __        __   _
 / _ \| | _| | \ \      / /__| |__
| | | | |/ _` | \ \ /\ / / _ \ '_ \
| |_| | | (_| |  \ V  V /  __/ |_) |
 \___/|_|\__,_|   \_/\_/ \___|_.__/
</div>
    <main id="main-content" class="container">
        <h1>Certificate Parser</h1>
        <p class="subtitle">Decode PEM certificates and CSRs, generate certificate signing requests</p>

        <div class="tabs" role="tablist" aria-label="Certificate tool options">
            <button type="button" class="tab-btn active" role="tab" aria-selected="true" aria-controls="tab-cert" id="tab-btn-cert" onclick="switchTab('cert')">Parse Certificate</button>
            <button type="button" class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-csr-parse" id="tab-btn-csr-parse" onclick="switchTab('csr-parse')">Parse CSR</button>
            <button type="button" class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-csr-gen" id="tab-btn-csr-gen" onclick="switchTab('csr-gen')">Generate CSR</button>
        </div>

        <!-- Parse Certificate Tab -->
        <div class="tab-content active" id="tab-cert" role="tabpanel" aria-labelledby="tab-btn-cert">
            <div class="calculator">
                <div class="input-group">
                    <label for="certInput">Paste PEM Certificate</label>
                    <textarea id="certInput" placeholder="-----BEGIN CERTIFICATE-----&#10;MIIDxTCCAq2gAwIBAgIQAqxcJmoLQ...&#10;-----END CERTIFICATE-----" aria-describedby="cert-help"></textarea>
                    <span id="cert-help" class="sr-only">Paste a PEM-encoded X.509 certificate to decode its information</span>
                </div>

                <div class="btn-row">
                    <button type="button" class="primary-btn" onclick="parseCertificate()" aria-label="Parse the certificate">Parse Certificate</button>
                    <button type="button" class="secondary-btn" onclick="clearCertInput()" aria-label="Clear input and results">Clear</button>
                    <button type="button" class="secondary-btn" onclick="loadSampleCert()" aria-label="Load a sample certificate for testing">Load Sample</button>
                </div>

                <div class="error" id="certError" role="alert" aria-live="assertive" aria-atomic="true"></div>

                <div class="results-section" id="certResults" role="region" aria-live="polite" aria-label="Certificate parsing results">
                    <div class="section-header">
                        <h3 class="section-title">Certificate Information</h3>
                        <button type="button" class="export-btn" onclick="exportCertToCSV()" aria-label="Export certificate details to CSV file">Export to CSV</button>
                    </div>

                    <div class="results-grid">
                        <div class="result-card" id="statusCard">
                            <h4>Status</h4>
                            <div class="value">
                                <span class="status-badge" id="certStatus">Valid</span>
                            </div>
                        </div>
                        <div class="result-card" id="daysCard">
                            <h4>Days Until Expiry</h4>
                            <div class="value">
                                <code id="certDays">-</code>
                            </div>
                        </div>
                    </div>

                    <div class="result-card">
                        <h4>Subject (CN)</h4>
                        <div class="value">
                            <code id="certSubject">-</code>
                            <button type="button" class="copy-btn" onclick="copyValue('certSubject', this)" aria-label="Copy subject to clipboard">Copy</button>
                        </div>
                        <div class="dn-display" id="subjectDN"></div>
                    </div>

                    <div class="result-card">
                        <h4>Issuer</h4>
                        <div class="value">
                            <code id="certIssuer">-</code>
                            <button type="button" class="copy-btn" onclick="copyValue('certIssuer', this)" aria-label="Copy issuer to clipboard">Copy</button>
                        </div>
                        <div class="dn-display" id="issuerDN"></div>
                    </div>

                    <div class="results-grid">
                        <div class="result-card">
                            <h4>Valid From</h4>
                            <div class="value">
                                <code id="certNotBefore">-</code>
                            </div>
                        </div>
                        <div class="result-card">
                            <h4>Valid Until</h4>
                            <div class="value">
                                <code id="certNotAfter">-</code>
                            </div>
                        </div>
                    </div>

                    <div class="result-card">
                        <h4>Serial Number</h4>
                        <div class="value">
                            <code id="certSerial">-</code>
                            <button type="button" class="copy-btn" onclick="copyValue('certSerial', this)" aria-label="Copy serial number to clipboard">Copy</button>
                        </div>
                    </div>

                    <div class="result-card">
                        <h4>Subject Alternative Names (SANs)</h4>
                        <ul class="san-list" id="certSANs" aria-label="List of subject alternative names">
                            <li>-</li>
                        </ul>
                    </div>

                    <div class="results-grid">
                        <div class="result-card">
                            <h4>Signature Algorithm</h4>
                            <div class="value">
                                <code id="certSigAlg">-</code>
                            </div>
                        </div>
                        <div class="result-card">
                            <h4>Public Key</h4>
                            <div class="value">
                                <code id="certPubKey">-</code>
                            </div>
                        </div>
                    </div>

                    <div class="result-card">
                        <h4>Fingerprint (SHA-256)</h4>
                        <div class="value">
                            <code id="certFingerprint">-</code>
                            <button type="button" class="copy-btn" onclick="copyValue('certFingerprint', this)" aria-label="Copy fingerprint to clipboard">Copy</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Parse CSR Tab -->
        <div class="tab-content" id="tab-csr-parse" role="tabpanel" aria-labelledby="tab-btn-csr-parse">
            <div class="calculator">
                <div class="input-group">
                    <label for="csrInput">Paste PEM CSR (Certificate Signing Request)</label>
                    <textarea id="csrInput" placeholder="-----BEGIN CERTIFICATE REQUEST-----&#10;MIICvDCCAaQCAQAwdzELMAkGA1UE...&#10;-----END CERTIFICATE REQUEST-----" aria-describedby="csr-parse-help"></textarea>
                    <span id="csr-parse-help" class="sr-only">Paste a PEM-encoded certificate signing request to decode its information</span>
                </div>

                <div class="btn-row">
                    <button type="button" class="primary-btn" onclick="parseCSR()" aria-label="Parse the CSR">Parse CSR</button>
                    <button type="button" class="secondary-btn" onclick="clearCSRInput()" aria-label="Clear input and results">Clear</button>
                    <button type="button" class="secondary-btn" onclick="loadSampleCSR()" aria-label="Load a sample CSR for testing">Load Sample</button>
                </div>

                <div class="error" id="csrError" role="alert" aria-live="assertive" aria-atomic="true"></div>

                <div class="results-section" id="csrResults" role="region" aria-live="polite" aria-label="CSR parsing results">
                    <div class="section-header">
                        <h3 class="section-title">CSR Information</h3>
                        <button type="button" class="export-btn" onclick="exportCSRToCSV()" aria-label="Export CSR details to CSV file">Export to CSV</button>
                    </div>

                    <div class="result-card">
                        <h4>Subject (CN)</h4>
                        <div class="value">
                            <code id="csrSubject">-</code>
                            <button type="button" class="copy-btn" onclick="copyValue('csrSubject', this)" aria-label="Copy subject to clipboard">Copy</button>
                        </div>
                        <div class="dn-display" id="csrSubjectDN"></div>
                    </div>

                    <div class="result-card">
                        <h4>Subject Alternative Names (SANs)</h4>
                        <ul class="san-list" id="csrSANs" aria-label="List of subject alternative names">
                            <li>-</li>
                        </ul>
                    </div>

                    <div class="results-grid">
                        <div class="result-card">
                            <h4>Signature Algorithm</h4>
                            <div class="value">
                                <code id="csrSigAlg">-</code>
                            </div>
                        </div>
                        <div class="result-card">
                            <h4>Public Key</h4>
                            <div class="value">
                                <code id="csrPubKey">-</code>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Generate CSR Tab -->
        <div class="tab-content" id="tab-csr-gen" role="tabpanel" aria-labelledby="tab-btn-csr-gen">
            <div class="calculator">
                <h3 class="section-title">Subject Information</h3>
                <div class="csr-form-grid">
                    <div class="input-group">
                        <label for="csrCN">Common Name (CN) *</label>
                        <input type="text" id="csrCN" placeholder="example.com" required aria-required="true">
                    </div>
                    <div class="input-group">
                        <label for="csrO">Organization (O)</label>
                        <input type="text" id="csrO" placeholder="My Company Inc">
                    </div>
                    <div class="input-group">
                        <label for="csrOU">Organizational Unit (OU)</label>
                        <input type="text" id="csrOU" placeholder="IT Department">
                    </div>
                    <div class="input-group">
                        <label for="csrL">Locality (L)</label>
                        <input type="text" id="csrL" placeholder="San Francisco">
                    </div>
                    <div class="input-group">
                        <label for="csrST">State (ST)</label>
                        <input type="text" id="csrST" placeholder="California">
                    </div>
                    <div class="input-group">
                        <label for="csrC">Country (C)</label>
                        <input type="text" id="csrC" placeholder="US" maxlength="2" pattern="[A-Za-z]{2}">
                    </div>
                </div>

                <div class="san-input-container">
                    <h3 class="section-title">Subject Alternative Names (Optional)</h3>
                    <div class="san-inputs" id="sanInputs">
                        <div class="san-row">
                            <input type="text" placeholder="www.example.com" aria-label="Subject alternative name 1">
                            <button type="button" class="remove-san" onclick="removeSAN(this)" aria-label="Remove this SAN">&times;</button>
                        </div>
                    </div>
                    <button type="button" class="add-san-btn" onclick="addSAN()" aria-label="Add another subject alternative name">+ Add SAN</button>
                </div>

                <h3 class="section-title">Key Options</h3>
                <div class="key-options" role="radiogroup" aria-label="Key algorithm selection">
                    <div class="key-option">
                        <input type="radio" id="keyRSA2048" name="keyType" value="RSA-2048" checked>
                        <label for="keyRSA2048">RSA 2048-bit</label>
                    </div>
                    <div class="key-option">
                        <input type="radio" id="keyRSA4096" name="keyType" value="RSA-4096">
                        <label for="keyRSA4096">RSA 4096-bit</label>
                    </div>
                    <div class="key-option">
                        <input type="radio" id="keyEC256" name="keyType" value="EC-P256">
                        <label for="keyEC256">ECDSA P-256</label>
                    </div>
                    <div class="key-option">
                        <input type="radio" id="keyEC384" name="keyType" value="EC-P384">
                        <label for="keyEC384">ECDSA P-384</label>
                    </div>
                </div>

                <div class="btn-row">
                    <button type="button" class="primary-btn" onclick="generateCSR()" aria-label="Generate CSR and private key">Generate CSR</button>
                    <button type="button" class="secondary-btn" onclick="clearCSRForm()" aria-label="Clear form">Clear Form</button>
                </div>

                <div class="error" id="genError" role="alert" aria-live="assertive" aria-atomic="true"></div>

                <div class="output-section" id="csrOutput">
                    <h4>Certificate Signing Request (CSR)</h4>
                    <textarea id="generatedCSR" readonly aria-label="Generated CSR"></textarea>
                    <div class="output-actions">
                        <button type="button" class="copy-btn" onclick="copyTextarea('generatedCSR', this)" aria-label="Copy CSR to clipboard">Copy CSR</button>
                        <button type="button" class="secondary-btn" onclick="downloadFile('generatedCSR', 'csr.pem')" aria-label="Download CSR file">Download CSR</button>
                    </div>
                </div>

                <div class="output-section" id="keyOutput">
                    <h4>Private Key (Keep Secret!)</h4>
                    <textarea id="generatedKey" readonly aria-label="Generated private key"></textarea>
                    <div class="output-actions">
                        <button type="button" class="copy-btn" onclick="copyTextarea('generatedKey', this)" aria-label="Copy private key to clipboard">Copy Key</button>
                        <button type="button" class="secondary-btn" onclick="downloadFile('generatedKey', 'private-key.pem')" aria-label="Download private key file">Download Key</button>
                    </div>
                </div>
            </div>
        </div>

        <button type="button" class="btn secondary" onclick="clearAllSavedData()" aria-label="Clear all saved form data from this page" style="max-width: 300px; margin: 20px auto;">Clear Saved Data</button>

        <footer role="contentinfo">
            Certificate Parser - All processing done locally in your browser
        </footer>
    </main>

    <script>
        // ASN.1 OID mappings
        const OID_MAP = {
            '2.5.4.3': 'CN',
            '2.5.4.6': 'C',
            '2.5.4.7': 'L',
            '2.5.4.8': 'ST',
            '2.5.4.10': 'O',
            '2.5.4.11': 'OU',
            '2.5.4.5': 'serialNumber',
            '2.5.4.12': 'title',
            '2.5.4.42': 'givenName',
            '2.5.4.4': 'surname',
            '1.2.840.113549.1.9.1': 'emailAddress',
            '2.5.29.17': 'subjectAltName',
            '1.2.840.113549.1.1.1': 'rsaEncryption',
            '1.2.840.113549.1.1.5': 'sha1WithRSAEncryption',
            '1.2.840.113549.1.1.11': 'sha256WithRSAEncryption',
            '1.2.840.113549.1.1.12': 'sha384WithRSAEncryption',
            '1.2.840.113549.1.1.13': 'sha512WithRSAEncryption',
            '1.2.840.10045.2.1': 'ecPublicKey',
            '1.2.840.10045.4.3.2': 'ecdsa-with-SHA256',
            '1.2.840.10045.4.3.3': 'ecdsa-with-SHA384',
            '1.2.840.10045.4.3.4': 'ecdsa-with-SHA512',
            '1.2.840.10045.3.1.7': 'prime256v1',
            '1.3.132.0.34': 'secp384r1',
            '1.3.132.0.35': 'secp521r1'
        };

        const SIG_ALG_NAMES = {
            'sha1WithRSAEncryption': 'SHA-1 with RSA',
            'sha256WithRSAEncryption': 'SHA-256 with RSA',
            'sha384WithRSAEncryption': 'SHA-384 with RSA',
            'sha512WithRSAEncryption': 'SHA-512 with RSA',
            'ecdsa-with-SHA256': 'ECDSA with SHA-256',
            'ecdsa-with-SHA384': 'ECDSA with SHA-384',
            'ecdsa-with-SHA512': 'ECDSA with SHA-512'
        };

        // Simple ASN.1 DER parser
        class ASN1Parser {
            constructor(data) {
                this.data = data;
                this.pos = 0;
            }

            peek() {
                return this.data[this.pos];
            }

            read(n = 1) {
                const result = this.data.slice(this.pos, this.pos + n);
                this.pos += n;
                return result;
            }

            readByte() {
                return this.data[this.pos++];
            }

            readLength() {
                let len = this.readByte();
                if (len & 0x80) {
                    const numBytes = len & 0x7f;
                    len = 0;
                    for (let i = 0; i < numBytes; i++) {
                        len = (len << 8) | this.readByte();
                    }
                }
                return len;
            }

            readTag() {
                return this.readByte();
            }

            readTLV() {
                const tag = this.readTag();
                const len = this.readLength();
                const value = this.read(len);
                return { tag, len, value };
            }

            readOID(bytes) {
                const oid = [];
                oid.push(Math.floor(bytes[0] / 40));
                oid.push(bytes[0] % 40);
                let val = 0;
                for (let i = 1; i < bytes.length; i++) {
                    val = (val << 7) | (bytes[i] & 0x7f);
                    if (!(bytes[i] & 0x80)) {
                        oid.push(val);
                        val = 0;
                    }
                }
                return oid.join('.');
            }

            readUTCTime(bytes) {
                const str = new TextDecoder().decode(bytes);
                let year = parseInt(str.slice(0, 2));
                year += (year >= 50) ? 1900 : 2000;
                const month = parseInt(str.slice(2, 4)) - 1;
                const day = parseInt(str.slice(4, 6));
                const hour = parseInt(str.slice(6, 8));
                const min = parseInt(str.slice(8, 10));
                const sec = parseInt(str.slice(10, 12));
                return new Date(Date.UTC(year, month, day, hour, min, sec));
            }

            readGeneralizedTime(bytes) {
                const str = new TextDecoder().decode(bytes);
                const year = parseInt(str.slice(0, 4));
                const month = parseInt(str.slice(4, 6)) - 1;
                const day = parseInt(str.slice(6, 8));
                const hour = parseInt(str.slice(8, 10));
                const min = parseInt(str.slice(10, 12));
                const sec = parseInt(str.slice(12, 14));
                return new Date(Date.UTC(year, month, day, hour, min, sec));
            }

            readInteger(bytes) {
                let hex = '';
                for (const b of bytes) {
                    hex += b.toString(16).padStart(2, '0');
                }
                return hex;
            }

            readBitString() {
                const unusedBits = this.readByte();
                const len = this.data.length - this.pos;
                return this.read(len);
            }
        }

        function base64ToUint8Array(base64) {
            const binary = atob(base64);
            const bytes = new Uint8Array(binary.length);
            for (let i = 0; i < binary.length; i++) {
                bytes[i] = binary.charCodeAt(i);
            }
            return bytes;
        }

        function uint8ArrayToBase64(bytes) {
            let binary = '';
            for (let i = 0; i < bytes.length; i++) {
                binary += String.fromCharCode(bytes[i]);
            }
            return btoa(binary);
        }

        function pemToBytes(pem) {
            const lines = pem.trim().split('\n');
            let base64 = '';
            for (const line of lines) {
                if (!line.startsWith('-----')) {
                    base64 += line.trim();
                }
            }
            return base64ToUint8Array(base64);
        }

        function parseDN(bytes) {
            const result = {};
            const parser = new ASN1Parser(bytes);

            while (parser.pos < bytes.length) {
                const setTag = parser.readTag();
                if (setTag !== 0x31) break;
                const setLen = parser.readLength();
                const setEnd = parser.pos + setLen;

                while (parser.pos < setEnd) {
                    const seqTag = parser.readTag();
                    if (seqTag !== 0x30) break;
                    const seqLen = parser.readLength();

                    const oidTag = parser.readTag();
                    const oidLen = parser.readLength();
                    const oidBytes = parser.read(oidLen);
                    const oid = parser.readOID.call({ readOID: ASN1Parser.prototype.readOID }, oidBytes);

                    const valTag = parser.readTag();
                    const valLen = parser.readLength();
                    const valBytes = parser.read(valLen);
                    const value = new TextDecoder().decode(valBytes);

                    const name = OID_MAP[oid] || oid;
                    result[name] = value;
                }
            }

            return result;
        }

        function parseExtensions(bytes) {
            const result = { sans: [] };
            const parser = new ASN1Parser(bytes);

            try {
                // Extensions is a SEQUENCE
                const seqTag = parser.readTag();
                const seqLen = parser.readLength();

                while (parser.pos < bytes.length) {
                    const extSeqTag = parser.readTag();
                    if (extSeqTag !== 0x30) break;
                    const extSeqLen = parser.readLength();
                    const extEnd = parser.pos + extSeqLen;

                    // OID
                    const oidTag = parser.readTag();
                    const oidLen = parser.readLength();
                    const oidBytes = parser.read(oidLen);
                    const oid = parser.readOID.call({ readOID: ASN1Parser.prototype.readOID }, oidBytes);

                    // Check for critical flag (BOOLEAN)
                    let critical = false;
                    if (parser.peek() === 0x01) {
                        parser.readTag();
                        const boolLen = parser.readLength();
                        critical = parser.readByte() !== 0;
                    }

                    // Extension value (OCTET STRING)
                    const octetTag = parser.readTag();
                    const octetLen = parser.readLength();
                    const octetValue = parser.read(octetLen);

                    // Parse SAN extension (OID 2.5.29.17)
                    if (oid === '2.5.29.17') {
                        result.sans = parseSANs(octetValue);
                    }

                    parser.pos = extEnd;
                }
            } catch (e) {
                // Extension parsing failed
            }

            return result;
        }

        function parseSANs(bytes) {
            const sans = [];
            const parser = new ASN1Parser(bytes);

            try {
                const seqTag = parser.readTag();
                const seqLen = parser.readLength();

                while (parser.pos < bytes.length) {
                    const tag = parser.readTag();
                    const len = parser.readLength();
                    const value = parser.read(len);

                    // Context-specific tags for SAN types
                    const tagType = tag & 0x1f;
                    let prefix = '';

                    switch (tagType) {
                        case 0: // otherName
                            prefix = 'otherName:';
                            break;
                        case 1: // rfc822Name (email)
                            prefix = 'email:';
                            break;
                        case 2: // dNSName
                            prefix = 'DNS:';
                            break;
                        case 6: // URI
                            prefix = 'URI:';
                            break;
                        case 7: // iPAddress
                            prefix = 'IP:';
                            if (len === 4) {
                                sans.push(prefix + value.join('.'));
                                continue;
                            } else if (len === 16) {
                                const parts = [];
                                for (let i = 0; i < 16; i += 2) {
                                    parts.push(((value[i] << 8) | value[i + 1]).toString(16));
                                }
                                sans.push(prefix + parts.join(':'));
                                continue;
                            }
                            break;
                        default:
                            prefix = `type${tagType}:`;
                    }

                    const strValue = new TextDecoder().decode(value);
                    sans.push(prefix + strValue);
                }
            } catch (e) {
                // SAN parsing failed
            }

            return sans;
        }

        function parseAlgorithm(bytes) {
            const parser = new ASN1Parser(bytes);
            const seqTag = parser.readTag();
            const seqLen = parser.readLength();

            const oidTag = parser.readTag();
            const oidLen = parser.readLength();
            const oidBytes = parser.read(oidLen);
            const oid = parser.readOID.call({ readOID: ASN1Parser.prototype.readOID }, oidBytes);

            const algName = OID_MAP[oid] || oid;
            return SIG_ALG_NAMES[algName] || algName;
        }

        function parsePublicKeyInfo(bytes) {
            const parser = new ASN1Parser(bytes);
            const seqTag = parser.readTag();
            const seqLen = parser.readLength();

            // Algorithm
            const algSeqTag = parser.readTag();
            const algSeqLen = parser.readLength();
            const algEnd = parser.pos + algSeqLen;

            const oidTag = parser.readTag();
            const oidLen = parser.readLength();
            const oidBytes = parser.read(oidLen);
            const oid = parser.readOID.call({ readOID: ASN1Parser.prototype.readOID }, oidBytes);

            let keyType = OID_MAP[oid] || oid;
            let keySize = '';

            // For EC keys, read the curve parameter
            if (keyType === 'ecPublicKey' && parser.pos < algEnd) {
                const curveTag = parser.readTag();
                const curveLen = parser.readLength();
                const curveBytes = parser.read(curveLen);
                const curveOid = parser.readOID.call({ readOID: ASN1Parser.prototype.readOID }, curveBytes);
                const curveName = OID_MAP[curveOid] || curveOid;

                if (curveName === 'prime256v1') keySize = 'P-256';
                else if (curveName === 'secp384r1') keySize = 'P-384';
                else if (curveName === 'secp521r1') keySize = 'P-521';
                else keySize = curveName;

                return `EC (${keySize})`;
            }

            parser.pos = algEnd;

            // For RSA, get key size from the bit string
            if (keyType === 'rsaEncryption') {
                const bitStringTag = parser.readTag();
                const bitStringLen = parser.readLength();
                const unusedBits = parser.readByte();

                // RSA public key is a SEQUENCE containing modulus and exponent
                const rsaSeqTag = parser.readTag();
                const rsaSeqLen = parser.readLength();

                const modTag = parser.readTag();
                const modLen = parser.readLength();

                // Key size is (modulus length - 1 for leading zero) * 8
                let actualLen = modLen;
                if (parser.peek() === 0) {
                    parser.readByte();
                    actualLen--;
                }
                keySize = actualLen * 8;

                return `RSA ${keySize}-bit`;
            }

            return keyType;
        }

        async function calculateFingerprint(bytes) {
            const hash = await crypto.subtle.digest('SHA-256', bytes);
            const hashArray = new Uint8Array(hash);
            return Array.from(hashArray)
                .map(b => b.toString(16).padStart(2, '0').toUpperCase())
                .join(':');
        }

        function parseCertificateData(bytes) {
            const result = {
                subject: {},
                issuer: {},
                notBefore: null,
                notAfter: null,
                serial: '',
                sigAlg: '',
                pubKey: '',
                sans: []
            };

            const parser = new ASN1Parser(bytes);

            try {
                // Certificate SEQUENCE
                const certSeqTag = parser.readTag();
                const certSeqLen = parser.readLength();

                // TBSCertificate SEQUENCE
                const tbsSeqTag = parser.readTag();
                const tbsSeqLen = parser.readLength();
                const tbsEnd = parser.pos + tbsSeqLen;

                // Version (context-specific tag 0, optional)
                if (parser.peek() === 0xa0) {
                    parser.readTag();
                    const vLen = parser.readLength();
                    parser.read(vLen);
                }

                // Serial Number (INTEGER)
                const serialTag = parser.readTag();
                const serialLen = parser.readLength();
                const serialBytes = parser.read(serialLen);
                result.serial = parser.readInteger.call({ readInteger: ASN1Parser.prototype.readInteger }, serialBytes).toUpperCase();

                // Signature Algorithm
                const sigAlgTag = parser.readTag();
                const sigAlgLen = parser.readLength();
                const sigAlgBytes = parser.read(sigAlgLen);

                // Parse signature algorithm
                const sigParser = new ASN1Parser(sigAlgBytes);
                const sigOidTag = sigParser.readTag();
                const sigOidLen = sigParser.readLength();
                const sigOidBytes = sigParser.read(sigOidLen);
                const sigOid = sigParser.readOID(sigOidBytes);
                const sigAlgName = OID_MAP[sigOid] || sigOid;
                result.sigAlg = SIG_ALG_NAMES[sigAlgName] || sigAlgName;

                // Issuer
                const issuerTag = parser.readTag();
                const issuerLen = parser.readLength();
                const issuerBytes = parser.read(issuerLen);
                result.issuer = parseDN(issuerBytes);

                // Validity
                const validityTag = parser.readTag();
                const validityLen = parser.readLength();
                const validityEnd = parser.pos + validityLen;

                // notBefore
                const nbTag = parser.readTag();
                const nbLen = parser.readLength();
                const nbBytes = parser.read(nbLen);
                if (nbTag === 0x17) {
                    result.notBefore = parser.readUTCTime.call({ readUTCTime: ASN1Parser.prototype.readUTCTime }, nbBytes);
                } else if (nbTag === 0x18) {
                    result.notBefore = parser.readGeneralizedTime.call({ readGeneralizedTime: ASN1Parser.prototype.readGeneralizedTime }, nbBytes);
                }

                // notAfter
                const naTag = parser.readTag();
                const naLen = parser.readLength();
                const naBytes = parser.read(naLen);
                if (naTag === 0x17) {
                    result.notAfter = parser.readUTCTime.call({ readUTCTime: ASN1Parser.prototype.readUTCTime }, naBytes);
                } else if (naTag === 0x18) {
                    result.notAfter = parser.readGeneralizedTime.call({ readGeneralizedTime: ASN1Parser.prototype.readGeneralizedTime }, naBytes);
                }

                // Subject
                const subjectTag = parser.readTag();
                const subjectLen = parser.readLength();
                const subjectBytes = parser.read(subjectLen);
                result.subject = parseDN(subjectBytes);

                // SubjectPublicKeyInfo
                const pubKeyInfoTag = parser.readTag();
                const pubKeyInfoLen = parser.readLength();
                const pubKeyStartPos = parser.pos - 2 - (pubKeyInfoLen > 127 ? Math.ceil(Math.log2(pubKeyInfoLen + 1) / 8) : 0);
                parser.pos = pubKeyStartPos;

                const pubKeyInfoBytes = new Uint8Array(bytes.buffer, bytes.byteOffset + parser.pos, pubKeyInfoLen + 4);
                result.pubKey = parsePublicKeyInfo(pubKeyInfoBytes);
                parser.pos += pubKeyInfoLen + 4;

                // Extensions (context-specific tag 3)
                while (parser.pos < tbsEnd) {
                    const extTag = parser.peek();
                    if (extTag === 0xa3) {
                        parser.readTag();
                        const extLen = parser.readLength();
                        const extBytes = parser.read(extLen);
                        const extInfo = parseExtensions(extBytes);
                        result.sans = extInfo.sans;
                    } else {
                        // Skip other implicit tags
                        const tag = parser.readTag();
                        const len = parser.readLength();
                        parser.read(len);
                    }
                }

            } catch (e) {
                console.error('Certificate parsing error:', e);
            }

            return result;
        }

        function parseCSRData(bytes) {
            const result = {
                subject: {},
                sigAlg: '',
                pubKey: '',
                sans: []
            };

            const parser = new ASN1Parser(bytes);

            try {
                // CertificationRequest SEQUENCE
                const reqSeqTag = parser.readTag();
                const reqSeqLen = parser.readLength();

                // CertificationRequestInfo SEQUENCE
                const infoSeqTag = parser.readTag();
                const infoSeqLen = parser.readLength();
                const infoEnd = parser.pos + infoSeqLen;

                // Version (INTEGER)
                const versionTag = parser.readTag();
                const versionLen = parser.readLength();
                parser.read(versionLen);

                // Subject
                const subjectTag = parser.readTag();
                const subjectLen = parser.readLength();
                const subjectBytes = parser.read(subjectLen);
                result.subject = parseDN(subjectBytes);

                // SubjectPublicKeyInfo
                const pubKeyInfoTag = parser.readTag();
                const pubKeyInfoLen = parser.readLength();
                const pubKeyStartPos = parser.pos - 2 - (pubKeyInfoLen > 127 ? Math.ceil(Math.log2(pubKeyInfoLen + 1) / 8) : 0);
                const pubKeyEndPos = parser.pos + pubKeyInfoLen;

                // Re-read to get the full SPKI
                parser.pos = pubKeyStartPos;
                const spkiTag = parser.readTag();
                const spkiLen = parser.readLength();
                const spkiBytes = parser.read(spkiLen);

                result.pubKey = parsePublicKeyInfo(new Uint8Array([0x30, ...encodeLength(spkiLen), ...spkiBytes]));
                parser.pos = pubKeyEndPos;

                // Attributes (context-specific tag 0)
                if (parser.pos < infoEnd && parser.peek() === 0xa0) {
                    parser.readTag();
                    const attrLen = parser.readLength();
                    const attrEnd = parser.pos + attrLen;

                    while (parser.pos < attrEnd) {
                        const attrSeqTag = parser.readTag();
                        if (attrSeqTag !== 0x30) break;
                        const attrSeqLen = parser.readLength();
                        const attrSeqEnd = parser.pos + attrSeqLen;

                        // Attribute OID
                        const attrOidTag = parser.readTag();
                        const attrOidLen = parser.readLength();
                        const attrOidBytes = parser.read(attrOidLen);
                        const attrOid = parser.readOID.call({ readOID: ASN1Parser.prototype.readOID }, attrOidBytes);

                        // extensionRequest OID: 1.2.840.113549.1.9.14
                        if (attrOid === '1.2.840.113549.1.9.14') {
                            // Attribute values SET
                            const setTag = parser.readTag();
                            const setLen = parser.readLength();

                            // Extensions SEQUENCE
                            const extSeqTag = parser.readTag();
                            const extSeqLen = parser.readLength();
                            const extBytes = parser.read(extSeqLen);

                            // Look for SAN extension
                            const extParser = new ASN1Parser(extBytes);
                            while (extParser.pos < extBytes.length) {
                                const eSeqTag = extParser.readTag();
                                if (eSeqTag !== 0x30) break;
                                const eSeqLen = extParser.readLength();
                                const eSeqEnd = extParser.pos + eSeqLen;

                                const eOidTag = extParser.readTag();
                                const eOidLen = extParser.readLength();
                                const eOidBytes = extParser.read(eOidLen);
                                const eOid = extParser.readOID(eOidBytes);

                                if (eOid === '2.5.29.17') {
                                    const octetTag = extParser.readTag();
                                    const octetLen = extParser.readLength();
                                    const octetBytes = extParser.read(octetLen);
                                    result.sans = parseSANs(octetBytes);
                                }

                                extParser.pos = eSeqEnd;
                            }
                        }

                        parser.pos = attrSeqEnd;
                    }
                }

                parser.pos = infoEnd;

                // SignatureAlgorithm
                const sigAlgSeqTag = parser.readTag();
                const sigAlgSeqLen = parser.readLength();
                const sigAlgBytes = parser.read(sigAlgSeqLen);

                const sigParser = new ASN1Parser(sigAlgBytes);
                const sigOidTag = sigParser.readTag();
                const sigOidLen = sigParser.readLength();
                const sigOidBytes = sigParser.read(sigOidLen);
                const sigOid = sigParser.readOID(sigOidBytes);
                const sigAlgName = OID_MAP[sigOid] || sigOid;
                result.sigAlg = SIG_ALG_NAMES[sigAlgName] || sigAlgName;

            } catch (e) {
                console.error('CSR parsing error:', e);
            }

            return result;
        }

        function formatDate(date) {
            if (!date) return '-';
            return date.toISOString().replace('T', ' ').replace(/\.\d+Z$/, ' UTC');
        }

        function formatDN(dn) {
            const order = ['CN', 'O', 'OU', 'L', 'ST', 'C', 'emailAddress'];
            let html = '';

            for (const key of order) {
                if (dn[key]) {
                    html += `<div class="dn-item"><span class="dn-label">${key}:</span><span class="dn-value">${escapeHtml(dn[key])}</span></div>`;
                }
            }

            // Add any remaining fields not in the standard order
            for (const [key, value] of Object.entries(dn)) {
                if (!order.includes(key)) {
                    html += `<div class="dn-item"><span class="dn-label">${key}:</span><span class="dn-value">${escapeHtml(value)}</span></div>`;
                }
            }

            return html;
        }

        function escapeHtml(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        async function parseCertificate() {
            const input = document.getElementById('certInput').value.trim();
            const errorDiv = document.getElementById('certError');
            const resultsDiv = document.getElementById('certResults');

            errorDiv.classList.remove('show');
            resultsDiv.classList.remove('show');

            if (!input) {
                showError('certError', 'Please paste a PEM certificate');
                A11yUtils.showError(document.getElementById('certInput'), 'Please paste a PEM certificate');
                return;
            }

            if (!input.includes('-----BEGIN CERTIFICATE-----')) {
                showError('certError', 'Invalid PEM format. Certificate should start with -----BEGIN CERTIFICATE-----');
                A11yUtils.showError(document.getElementById('certInput'), 'Invalid PEM format');
                return;
            }

            try {
                const bytes = pemToBytes(input);
                const certData = parseCertificateData(bytes);
                const fingerprint = await calculateFingerprint(bytes);

                // Display results
                document.getElementById('certSubject').textContent = certData.subject.CN || '-';
                document.getElementById('subjectDN').innerHTML = formatDN(certData.subject);

                document.getElementById('certIssuer').textContent = certData.issuer.CN || certData.issuer.O || '-';
                document.getElementById('issuerDN').innerHTML = formatDN(certData.issuer);

                document.getElementById('certNotBefore').textContent = formatDate(certData.notBefore);
                document.getElementById('certNotAfter').textContent = formatDate(certData.notAfter);

                document.getElementById('certSerial').textContent = certData.serial || '-';
                document.getElementById('certSigAlg').textContent = certData.sigAlg || '-';
                document.getElementById('certPubKey').textContent = certData.pubKey || '-';
                document.getElementById('certFingerprint').textContent = fingerprint;

                // SANs
                const sansEl = document.getElementById('certSANs');
                if (certData.sans.length > 0) {
                    sansEl.innerHTML = certData.sans.map(san => `<li>${escapeHtml(san)}</li>`).join('');
                } else {
                    sansEl.innerHTML = '<li>None</li>';
                }

                // Status and days until expiry
                const now = new Date();
                const statusEl = document.getElementById('certStatus');
                const statusCard = document.getElementById('statusCard');
                const daysCard = document.getElementById('daysCard');
                const daysEl = document.getElementById('certDays');

                if (certData.notAfter) {
                    const daysUntilExpiry = Math.floor((certData.notAfter - now) / (1000 * 60 * 60 * 24));
                    daysEl.textContent = daysUntilExpiry;

                    if (now < certData.notBefore) {
                        statusEl.textContent = 'Not Yet Valid';
                        statusEl.className = 'status-badge expiring';
                        statusCard.className = 'result-card warning';
                        daysCard.className = 'result-card warning';
                    } else if (now > certData.notAfter) {
                        statusEl.textContent = 'Expired';
                        statusEl.className = 'status-badge expired';
                        statusCard.className = 'result-card expired';
                        daysCard.className = 'result-card expired';
                    } else if (daysUntilExpiry <= 30) {
                        statusEl.textContent = 'Expiring Soon';
                        statusEl.className = 'status-badge expiring';
                        statusCard.className = 'result-card warning';
                        daysCard.className = 'result-card warning';
                    } else {
                        statusEl.textContent = 'Valid';
                        statusEl.className = 'status-badge valid';
                        statusCard.className = 'result-card valid';
                        daysCard.className = 'result-card valid';
                    }
                } else {
                    statusEl.textContent = 'Unknown';
                    statusEl.className = 'status-badge';
                    daysEl.textContent = '-';
                }

                resultsDiv.classList.add('show');
                A11yUtils.announce('Certificate parsed successfully', 'polite');
                A11yUtils.clearError(document.getElementById('certInput'));

            } catch (e) {
                console.error(e);
                showError('certError', 'Failed to parse certificate: ' + e.message);
                A11yUtils.showError(document.getElementById('certInput'), 'Failed to parse certificate');
            }
        }

        async function parseCSR() {
            const input = document.getElementById('csrInput').value.trim();
            const errorDiv = document.getElementById('csrError');
            const resultsDiv = document.getElementById('csrResults');

            errorDiv.classList.remove('show');
            resultsDiv.classList.remove('show');

            if (!input) {
                showError('csrError', 'Please paste a PEM CSR');
                A11yUtils.showError(document.getElementById('csrInput'), 'Please paste a PEM CSR');
                return;
            }

            if (!input.includes('-----BEGIN CERTIFICATE REQUEST-----') && !input.includes('-----BEGIN NEW CERTIFICATE REQUEST-----')) {
                showError('csrError', 'Invalid PEM format. CSR should start with -----BEGIN CERTIFICATE REQUEST-----');
                A11yUtils.showError(document.getElementById('csrInput'), 'Invalid PEM format');
                return;
            }

            try {
                const bytes = pemToBytes(input);
                const csrData = parseCSRData(bytes);

                // Display results
                document.getElementById('csrSubject').textContent = csrData.subject.CN || '-';
                document.getElementById('csrSubjectDN').innerHTML = formatDN(csrData.subject);

                document.getElementById('csrSigAlg').textContent = csrData.sigAlg || '-';
                document.getElementById('csrPubKey').textContent = csrData.pubKey || '-';

                // SANs
                const sansEl = document.getElementById('csrSANs');
                if (csrData.sans.length > 0) {
                    sansEl.innerHTML = csrData.sans.map(san => `<li>${escapeHtml(san)}</li>`).join('');
                } else {
                    sansEl.innerHTML = '<li>None</li>';
                }

                resultsDiv.classList.add('show');
                A11yUtils.announce('CSR parsed successfully', 'polite');
                A11yUtils.clearError(document.getElementById('csrInput'));

            } catch (e) {
                console.error(e);
                showError('csrError', 'Failed to parse CSR: ' + e.message);
                A11yUtils.showError(document.getElementById('csrInput'), 'Failed to parse CSR');
            }
        }

        // ASN.1 DER encoding helpers
        function encodeLength(len) {
            if (len < 128) {
                return [len];
            }
            const bytes = [];
            let temp = len;
            while (temp > 0) {
                bytes.unshift(temp & 0xff);
                temp >>= 8;
            }
            return [0x80 | bytes.length, ...bytes];
        }

        function encodeOID(oid) {
            const parts = oid.split('.').map(Number);
            const bytes = [parts[0] * 40 + parts[1]];

            for (let i = 2; i < parts.length; i++) {
                let val = parts[i];
                if (val === 0) {
                    bytes.push(0);
                } else {
                    const encoded = [];
                    while (val > 0) {
                        encoded.unshift((val & 0x7f) | (encoded.length ? 0x80 : 0));
                        val >>= 7;
                    }
                    bytes.push(...encoded);
                }
            }

            return [0x06, ...encodeLength(bytes.length), ...bytes];
        }

        function encodeUTF8String(str) {
            const bytes = new TextEncoder().encode(str);
            return [0x0c, ...encodeLength(bytes.length), ...bytes];
        }

        function encodePrintableString(str) {
            const bytes = new TextEncoder().encode(str);
            return [0x13, ...encodeLength(bytes.length), ...bytes];
        }

        function encodeIA5String(str) {
            const bytes = new TextEncoder().encode(str);
            return [0x16, ...encodeLength(bytes.length), ...bytes];
        }

        function encodeSequence(contents) {
            return [0x30, ...encodeLength(contents.length), ...contents];
        }

        function encodeSet(contents) {
            return [0x31, ...encodeLength(contents.length), ...contents];
        }

        function encodeContextSpecific(tag, contents, explicit = true) {
            if (explicit) {
                return [0xa0 | tag, ...encodeLength(contents.length), ...contents];
            }
            return [0x80 | tag, ...encodeLength(contents.length), ...contents];
        }

        function encodeBitString(bytes) {
            return [0x03, ...encodeLength(bytes.length + 1), 0x00, ...bytes];
        }

        function encodeInteger(value) {
            if (value === 0) {
                return [0x02, 0x01, 0x00];
            }
            const bytes = [];
            let temp = value;
            while (temp > 0) {
                bytes.unshift(temp & 0xff);
                temp >>= 8;
            }
            // Add leading zero if high bit is set
            if (bytes[0] & 0x80) {
                bytes.unshift(0);
            }
            return [0x02, ...encodeLength(bytes.length), ...bytes];
        }

        function encodeRDN(oid, value) {
            const oidEncoded = encodeOID(oid);
            // Use PrintableString for country code, UTF8String for others
            const valueEncoded = oid === '2.5.4.6' ? encodePrintableString(value) : encodeUTF8String(value);
            const atv = encodeSequence([...oidEncoded, ...valueEncoded]);
            return encodeSet(atv);
        }

        function encodeDN(dn) {
            const rdns = [];

            const fields = [
                { key: 'CN', oid: '2.5.4.3' },
                { key: 'O', oid: '2.5.4.10' },
                { key: 'OU', oid: '2.5.4.11' },
                { key: 'L', oid: '2.5.4.7' },
                { key: 'ST', oid: '2.5.4.8' },
                { key: 'C', oid: '2.5.4.6' }
            ];

            for (const field of fields) {
                if (dn[field.key]) {
                    rdns.push(...encodeRDN(field.oid, dn[field.key]));
                }
            }

            return encodeSequence(rdns);
        }

        function encodeSANExtension(sans) {
            const sanEntries = [];

            for (const san of sans) {
                if (san.trim()) {
                    // Encode as dNSName (context-specific tag 2)
                    const bytes = new TextEncoder().encode(san.trim());
                    sanEntries.push(0x82, ...encodeLength(bytes.length), ...bytes);
                }
            }

            if (sanEntries.length === 0) {
                return [];
            }

            const sanSequence = encodeSequence(sanEntries);
            const octetString = [0x04, ...encodeLength(sanSequence.length), ...sanSequence];

            // Extension: OID + OCTET STRING
            const extOid = encodeOID('2.5.29.17');
            const extension = encodeSequence([...extOid, ...octetString]);

            return extension;
        }

        async function generateCSR() {
            const cn = document.getElementById('csrCN').value.trim();

            if (!cn) {
                showError('genError', 'Common Name (CN) is required');
                A11yUtils.showError(document.getElementById('csrCN'), 'Common Name is required');
                document.getElementById('csrCN').focus();
                return;
            }

            hideError('genError');

            const dn = {
                CN: cn,
                O: document.getElementById('csrO').value.trim(),
                OU: document.getElementById('csrOU').value.trim(),
                L: document.getElementById('csrL').value.trim(),
                ST: document.getElementById('csrST').value.trim(),
                C: document.getElementById('csrC').value.trim().toUpperCase()
            };

            // Collect SANs
            const sanInputs = document.querySelectorAll('#sanInputs input');
            const sans = [cn]; // Include CN as first SAN
            sanInputs.forEach(input => {
                const val = input.value.trim();
                if (val && val !== cn) {
                    sans.push(val);
                }
            });

            const keyType = document.querySelector('input[name="keyType"]:checked').value;

            try {
                let keyPair;
                let algorithm;
                let signAlgorithm;

                if (keyType.startsWith('RSA')) {
                    const modulusLength = keyType === 'RSA-4096' ? 4096 : 2048;
                    algorithm = {
                        name: 'RSASSA-PKCS1-v1_5',
                        modulusLength: modulusLength,
                        publicExponent: new Uint8Array([0x01, 0x00, 0x01]),
                        hash: 'SHA-256'
                    };
                    signAlgorithm = { name: 'RSASSA-PKCS1-v1_5' };
                } else {
                    const namedCurve = keyType === 'EC-P384' ? 'P-384' : 'P-256';
                    algorithm = {
                        name: 'ECDSA',
                        namedCurve: namedCurve
                    };
                    signAlgorithm = {
                        name: 'ECDSA',
                        hash: namedCurve === 'P-384' ? 'SHA-384' : 'SHA-256'
                    };
                }

                keyPair = await crypto.subtle.generateKey(algorithm, true, ['sign']);

                // Export public key as SPKI
                const spkiBuffer = await crypto.subtle.exportKey('spki', keyPair.publicKey);
                const spkiBytes = new Uint8Array(spkiBuffer);

                // Build CSR
                const dnEncoded = encodeDN(dn);

                // Build attributes with SAN extension
                let attributes = [];
                const sanExt = encodeSANExtension(sans);
                if (sanExt.length > 0) {
                    const extensions = encodeSequence(sanExt);
                    const extReqOid = encodeOID('1.2.840.113549.1.9.14');
                    const extReqValue = encodeSet(extensions);
                    const extReqAttr = encodeSequence([...extReqOid, ...extReqValue]);
                    attributes = encodeContextSpecific(0, extReqAttr);
                } else {
                    attributes = encodeContextSpecific(0, []);
                }

                // CertificationRequestInfo
                const version = encodeInteger(0);
                const certReqInfo = encodeSequence([
                    ...version,
                    ...dnEncoded,
                    ...spkiBytes,
                    ...attributes
                ]);

                // Sign the CertificationRequestInfo
                const signature = await crypto.subtle.sign(signAlgorithm, keyPair.privateKey, new Uint8Array(certReqInfo));
                const signatureBytes = new Uint8Array(signature);

                // Signature algorithm identifier
                let sigAlgId;
                if (keyType.startsWith('RSA')) {
                    sigAlgId = encodeSequence([...encodeOID('1.2.840.113549.1.1.11'), 0x05, 0x00]); // sha256WithRSAEncryption
                } else if (keyType === 'EC-P384') {
                    sigAlgId = encodeSequence([...encodeOID('1.2.840.10045.4.3.3')]); // ecdsa-with-SHA384
                } else {
                    sigAlgId = encodeSequence([...encodeOID('1.2.840.10045.4.3.2')]); // ecdsa-with-SHA256
                }

                // Complete CSR
                const csr = encodeSequence([
                    ...certReqInfo,
                    ...sigAlgId,
                    ...encodeBitString([...signatureBytes])
                ]);

                // Convert to PEM
                const csrBase64 = uint8ArrayToBase64(new Uint8Array(csr));
                const csrPem = '-----BEGIN CERTIFICATE REQUEST-----\n' +
                    csrBase64.match(/.{1,64}/g).join('\n') +
                    '\n-----END CERTIFICATE REQUEST-----';

                // Export private key
                const pkcs8Buffer = await crypto.subtle.exportKey('pkcs8', keyPair.privateKey);
                const pkcs8Base64 = uint8ArrayToBase64(new Uint8Array(pkcs8Buffer));
                const keyPem = '-----BEGIN PRIVATE KEY-----\n' +
                    pkcs8Base64.match(/.{1,64}/g).join('\n') +
                    '\n-----END PRIVATE KEY-----';

                // Display results
                document.getElementById('generatedCSR').value = csrPem;
                document.getElementById('generatedKey').value = keyPem;
                document.getElementById('csrOutput').classList.add('show');
                document.getElementById('keyOutput').classList.add('show');

                A11yUtils.announce('CSR and private key generated successfully', 'polite');

            } catch (e) {
                console.error(e);
                showError('genError', 'Failed to generate CSR: ' + e.message);
            }
        }

        function switchTab(tabId) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-selected', 'false');
            });
            document.getElementById('tab-btn-' + tabId).classList.add('active');
            document.getElementById('tab-btn-' + tabId).setAttribute('aria-selected', 'true');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById('tab-' + tabId).classList.add('active');

            A11yUtils.announce('Switched to ' + document.getElementById('tab-btn-' + tabId).textContent + ' tab', 'polite');
        }

        function showError(elementId, message) {
            const errorDiv = document.getElementById(elementId);
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
        }

        function hideError(elementId) {
            document.getElementById(elementId).classList.remove('show');
        }

        function clearCertInput() {
            document.getElementById('certInput').value = '';
            document.getElementById('certResults').classList.remove('show');
            document.getElementById('certError').classList.remove('show');
            A11yUtils.clearError(document.getElementById('certInput'));
            A11yUtils.announce('Certificate input cleared', 'polite');
        }

        function clearCSRInput() {
            document.getElementById('csrInput').value = '';
            document.getElementById('csrResults').classList.remove('show');
            document.getElementById('csrError').classList.remove('show');
            A11yUtils.clearError(document.getElementById('csrInput'));
            A11yUtils.announce('CSR input cleared', 'polite');
        }

        function clearCSRForm() {
            document.getElementById('csrCN').value = '';
            document.getElementById('csrO').value = '';
            document.getElementById('csrOU').value = '';
            document.getElementById('csrL').value = '';
            document.getElementById('csrST').value = '';
            document.getElementById('csrC').value = '';
            document.getElementById('sanInputs').innerHTML = '<div class="san-row"><input type="text" placeholder="www.example.com" aria-label="Subject alternative name 1"><button type="button" class="remove-san" onclick="removeSAN(this)" aria-label="Remove this SAN">&times;</button></div>';
            document.getElementById('csrOutput').classList.remove('show');
            document.getElementById('keyOutput').classList.remove('show');
            document.getElementById('genError').classList.remove('show');
            A11yUtils.announce('Form cleared', 'polite');
        }

        function addSAN() {
            const container = document.getElementById('sanInputs');
            const count = container.querySelectorAll('.san-row').length + 1;
            const row = document.createElement('div');
            row.className = 'san-row';
            row.innerHTML = `<input type="text" placeholder="subdomain.example.com" aria-label="Subject alternative name ${count}"><button type="button" class="remove-san" onclick="removeSAN(this)" aria-label="Remove this SAN">&times;</button>`;
            container.appendChild(row);
            row.querySelector('input').focus();
        }

        function removeSAN(btn) {
            const container = document.getElementById('sanInputs');
            if (container.querySelectorAll('.san-row').length > 1) {
                btn.parentElement.remove();
            } else {
                btn.parentElement.querySelector('input').value = '';
            }
        }

        function copyValue(elementId, button) {
            const value = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(value).then(() => {
                button.textContent = 'Copied!';
                button.classList.add('copied');
                A11yUtils.announce('Copied to clipboard', 'polite');
                setTimeout(() => {
                    button.textContent = 'Copy';
                    button.classList.remove('copied');
                }, 1500);
            });
        }

        function copyTextarea(elementId, button) {
            const value = document.getElementById(elementId).value;
            navigator.clipboard.writeText(value).then(() => {
                button.textContent = 'Copied!';
                button.classList.add('copied');
                A11yUtils.announce('Copied to clipboard', 'polite');
                setTimeout(() => {
                    button.textContent = button.textContent.replace('Copied!', 'Copy');
                    button.classList.remove('copied');
                }, 1500);
            });
        }

        function downloadFile(elementId, filename) {
            const content = document.getElementById(elementId).value;
            const blob = new Blob([content], { type: 'application/x-pem-file' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            A11yUtils.announce('File downloaded: ' + filename, 'polite');
        }

        function loadSampleCert() {
            // Sample self-signed certificate for testing
            const sampleCert = `-----BEGIN CERTIFICATE-----
MIIDkzCCAnugAwIBAgIUEqLs9DXMN3xV7t1VVvAhNPVTLtcwDQYJKoZIhvcNAQEL
BQAwWTELMAkGA1UEBhMCVVMxEzARBgNVBAgMCkNhbGlmb3JuaWExFjAUBgNVBAcM
DVNhbiBGcmFuY2lzY28xHTAbBgNVBAoMFEV4YW1wbGUgT3JnYW5pemF0aW9uMB4X
DTI0MDEwMTAwMDAwMFoXDTI1MDEwMTAwMDAwMFowWTELMAkGA1UEBhMCVVMxEzAR
BgNVBAgMCkNhbGlmb3JuaWExFjAUBgNVBAcMDVNhbiBGcmFuY2lzY28xHTAbBgNV
BAoMFEV4YW1wbGUgT3JnYW5pemF0aW9uMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8A
MIIBCgKCAQEA0Z3VS5JJcds3xfn/ygWyF8PbnGy0AHJSxKTgGv4PjUW2RNXBHUUO
b3PUa6VPl9vZYPGvMi3RURO3+K15Dqv3+P7yXEkrOKZfAh6rixDbTnKPPs2rSvPK
Zqg+erpPswHxH2PwS8dZVFhkCth8VBLw7fvvOAx6b8e9kCx9Lj3hCvthqfnlfinN
hIq/dKxmNKc6hXBPv7TkteVSVH4UV1R1XLTSxtyQ2CdxHJYFqjqwPmFCBcO9rGnF
mMGNmqBi4JBmx7F7UYOmkfTV37F7NSUX8rPR3X27WO1i1Ec/bHIWBmrPvHGJfYMn
Q4z5WYm8RTYK5THZQQNAvfRjdKqLwgY3swIDAQABo1MwUTAdBgNVHQ4EFgQUKsae
E+hzl9FLzCVh6xRJ9KdIJ4kwHwYDVR0jBBgwFoAUKsaeE+hzl9FLzCVh6xRJ9KdI
J4kwDwYDVR0TAQH/BAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEAVGaBrANlNlyO
W+hZDc/d34INmEGhu77cPxBdFo+w3cP1+tfVzMdMBwwV0F8YB8DdHcOILsqzZmCG
F6J9HJi7mVMjD3s+5FPhLCHMD7TEDBE8hEL3wR7V1qHK5fhNL7pkZ7c5PpDM4lKJ
yJG7m3nJL8bvBcKcXbLBXc6RUOTX2pTHL5hLmE/5yTL8lOxXFjwH1mPfTqAn7gBq
V14fiWVk8Z3SbfrJiLhYOFJgENE3OLr0MhIrdfo2jDb1o5LFbqaHJoVvPT5gN1s2
t+xCOGCLMHIQhWnsF0oDfWS0C9YqK7Ax+PsYQi4HoZBYsYJyO6LGbT1SkWELWtIL
gOAWoKW1Fw==
-----END CERTIFICATE-----`;
            document.getElementById('certInput').value = sampleCert;
            A11yUtils.announce('Sample certificate loaded', 'polite');
        }

        function loadSampleCSR() {
            const sampleCSR = `-----BEGIN CERTIFICATE REQUEST-----
MIICijCCAXICAQAwRTELMAkGA1UEBhMCVVMxEzARBgNVBAgMClNvbWUtU3RhdGUx
ITAfBgNVBAoMGEludGVybmV0IFdpZGdpdHMgUHR5IEx0ZDCCASIwDQYJKoZIhvcN
AQEBBQADggEPADCCAQoCggEBAMCgPfVC03bosuqYh8PVPCyN+An0hRF6Dlb6Xdla
p8mW4eCbPbTqLDfVPGSBQ6VzHV9sK5VhxTW+gNF/C7Z9FIh7HNSF2PZBW8gNL7kL
KVUeVLIg2vWF0UXVN8qk5ExfLHfWaK+fV6LR5f6J4pI9MglJwkgqHkJb37z6zK0b
7b1+uUxSaM9t6o7e+8J3/sMnRLPaKnKlxm8v/KhFN8MzHn7tLHyPH7zhL9NcLl7y
WJ7Y4J8jTZ3b9oMc6IJ3i7mUdaOuXNFJq6Q6j2r0Y1hIy+pQ2j5PgQQXKqVbWDnE
L0BIR1nbfhLz2F4sS0JtYmrpIJTsVp6QamQk0lQ2QFQQ1oMCAwEAAaAAMA0GCSqG
SIb3DQEBCwUAA4IBAQBuYXFP3fovFZ3WxZvsP8rxGgD6YK7hB6sS8oq6Gqng7qr3
L16K9BQ1B7F3bfPKT0IpOlgQH4u3lXhvJ6F3S/r+dW8Z1x9q5p/HVr8fzm5EJQT7
+lLQT9D3WQ8dNfDDDu7VDaXHVqf8r0bYxUdI/uKF9PhYW3Z/JfLBuK0P5x3B6UH2
y5DVSHcXwNYKdMOcMqYBq6UkEB/aH1JHh4oc7UaD9YAHsEJrm2fJejkOvQJGJmH/
DjMgEvYmpP1PdeYyg6v8UDZIR4kOajXYdnGZ8fk6s9aV1jwVzWUEeq3YrH1R2fV+
IWUFpcgPGm/6jH4LKv3d8SQBmEgApyvsCtoXCW6E
-----END CERTIFICATE REQUEST-----`;
            document.getElementById('csrInput').value = sampleCSR;
            A11yUtils.announce('Sample CSR loaded', 'polite');
        }

        // CSV Export Functions
        function downloadCSV(filename, csvContent) {
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);

            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function escapeCSV(value) {
            if (value === null || value === undefined) return '';
            const str = String(value);
            if (str.includes(',') || str.includes('"') || str.includes('\n')) {
                return '"' + str.replace(/"/g, '""') + '"';
            }
            return str;
        }

        function exportCertToCSV() {
            const status = document.getElementById('certStatus').textContent;
            const daysUntilExpiry = document.getElementById('certDays').textContent;
            const subject = document.getElementById('certSubject').textContent;
            const issuer = document.getElementById('certIssuer').textContent;
            const notBefore = document.getElementById('certNotBefore').textContent;
            const notAfter = document.getElementById('certNotAfter').textContent;
            const serial = document.getElementById('certSerial').textContent;
            const sigAlg = document.getElementById('certSigAlg').textContent;
            const pubKey = document.getElementById('certPubKey').textContent;
            const fingerprint = document.getElementById('certFingerprint').textContent;

            // Get SANs
            const sanElements = document.querySelectorAll('#certSANs li');
            const sans = Array.from(sanElements).map(li => li.textContent).join('; ');

            // Get full subject DN
            const subjectDNItems = document.querySelectorAll('#subjectDN .dn-item');
            const subjectDN = Array.from(subjectDNItems).map(item => {
                const label = item.querySelector('.dn-label').textContent;
                const value = item.querySelector('.dn-value').textContent;
                return label + value;
            }).join(', ');

            // Get full issuer DN
            const issuerDNItems = document.querySelectorAll('#issuerDN .dn-item');
            const issuerDN = Array.from(issuerDNItems).map(item => {
                const label = item.querySelector('.dn-label').textContent;
                const value = item.querySelector('.dn-value').textContent;
                return label + value;
            }).join(', ');

            const csvRows = [
                ['Field', 'Value'],
                ['Status', status],
                ['Days Until Expiry', daysUntilExpiry],
                ['Subject (CN)', subject],
                ['Subject (Full DN)', subjectDN],
                ['Issuer (CN)', issuer],
                ['Issuer (Full DN)', issuerDN],
                ['Valid From', notBefore],
                ['Valid Until', notAfter],
                ['Serial Number', serial],
                ['Signature Algorithm', sigAlg],
                ['Public Key', pubKey],
                ['SHA-256 Fingerprint', fingerprint],
                ['Subject Alternative Names', sans]
            ];

            const csvContent = csvRows.map(row => row.map(escapeCSV).join(',')).join('\n');
            const filename = `certificate-${subject.replace(/[^a-zA-Z0-9.-]/g, '_')}-${new Date().toISOString().split('T')[0]}.csv`;

            downloadCSV(filename, csvContent);
            A11yUtils.announce('Certificate details exported to CSV file', 'polite');
        }

        function exportCSRToCSV() {
            const subject = document.getElementById('csrSubject').textContent;
            const sigAlg = document.getElementById('csrSigAlg').textContent;
            const pubKey = document.getElementById('csrPubKey').textContent;

            // Get SANs
            const sanElements = document.querySelectorAll('#csrSANs li');
            const sans = Array.from(sanElements).map(li => li.textContent).join('; ');

            // Get full subject DN
            const subjectDNItems = document.querySelectorAll('#csrSubjectDN .dn-item');
            const subjectDN = Array.from(subjectDNItems).map(item => {
                const label = item.querySelector('.dn-label').textContent;
                const value = item.querySelector('.dn-value').textContent;
                return label + value;
            }).join(', ');

            const csvRows = [
                ['Field', 'Value'],
                ['Subject (CN)', subject],
                ['Subject (Full DN)', subjectDN],
                ['Signature Algorithm', sigAlg],
                ['Public Key', pubKey],
                ['Subject Alternative Names', sans]
            ];

            const csvContent = csvRows.map(row => row.map(escapeCSV).join(',')).join('\n');
            const filename = `csr-${subject.replace(/[^a-zA-Z0-9.-]/g, '_')}-${new Date().toISOString().split('T')[0]}.csv`;

            downloadCSV(filename, csvContent);
            A11yUtils.announce('CSR details exported to CSV file', 'polite');
        }

        // Initialize skip link
        document.querySelector('.skip-link').addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.getElementById('main-content');
            if (target) {
                target.setAttribute('tabindex', '-1');
                target.focus();
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });

        // Keyboard navigation for tabs
        document.querySelectorAll('.tab-btn').forEach((btn, index, btns) => {
            btn.addEventListener('keydown', function(e) {
                let targetIndex = index;
                if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
                    e.preventDefault();
                    targetIndex = (index + 1) % btns.length;
                } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
                    e.preventDefault();
                    targetIndex = (index - 1 + btns.length) % btns.length;
                } else if (e.key === 'Home') {
                    e.preventDefault();
                    targetIndex = 0;
                } else if (e.key === 'End') {
                    e.preventDefault();
                    targetIndex = btns.length - 1;
                }
                if (targetIndex !== index) {
                    btns[targetIndex].focus();
                    btns[targetIndex].click();
                }
            });
        });

        // localStorage persistence
        const certParserFields = ['certInput', 'csrInput', 'csrCN', 'csrO', 'csrOU', 'csrL', 'csrST', 'csrC'];

        function clearAllSavedData() {
            StorageUtils.remove('cert-parser');
            // Reset to defaults
            document.getElementById('certInput').value = '';
            document.getElementById('csrInput').value = '';
            document.getElementById('csrCN').value = '';
            document.getElementById('csrO').value = '';
            document.getElementById('csrOU').value = '';
            document.getElementById('csrL').value = '';
            document.getElementById('csrST').value = '';
            document.getElementById('csrC').value = '';
            // Clear all SAN inputs except the first one
            const sanInputs = document.getElementById('sanInputs');
            const firstSanRow = sanInputs.querySelector('.san-row');
            if (firstSanRow) {
                firstSanRow.querySelector('input').value = '';
                // Remove all other SAN rows
                const allRows = sanInputs.querySelectorAll('.san-row');
                allRows.forEach((row, index) => {
                    if (index > 0) row.remove();
                });
            }
            // Hide results sections
            document.getElementById('certResults').classList.remove('show');
            document.getElementById('csrResults').classList.remove('show');
            document.getElementById('csrOutput').classList.remove('show');
            document.getElementById('keyOutput').classList.remove('show');
            A11yUtils.announce('All saved data has been cleared', 'polite');
        }

        document.addEventListener('DOMContentLoaded', function() {
            StorageUtils.loadFormInputs('cert-parser', certParserFields);
            StorageUtils.autoSaveFormInputs('cert-parser', certParserFields);
        });
    </script>
</body>
</html>
